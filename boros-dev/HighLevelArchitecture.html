<!doctype html>
<html lang="en-US" dir="ltr" class="docs-wrapper plugin-docs plugin-id-boros-dev docs-version-current docs-doc-page docs-doc-id-HighLevelArchitecture" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">High Level Architecture | Pendle Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://pendle.finance/boros-dev/HighLevelArchitecture"><meta data-rh="true" property="og:locale" content="en_US"><meta data-rh="true" property="og:locale:alternate" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-boros-dev-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-boros-dev-current"><meta data-rh="true" property="og:title" content="High Level Architecture | Pendle Documentation"><meta data-rh="true" name="description" content="Core Contracts"><meta data-rh="true" property="og:description" content="Core Contracts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://pendle.finance/boros-dev/HighLevelArchitecture"><link data-rh="true" rel="alternate" href="https://pendle.finance/boros-dev/HighLevelArchitecture" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://pendle.finance/cn/boros-dev/HighLevelArchitecture" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://pendle.finance/boros-dev/HighLevelArchitecture" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://GFVY0GOMCR-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"🏗️ High Level Architecture","item":"https://pendle.finance/boros-dev/HighLevelArchitecture"}]}</script><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6ZBS49V0YS"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-6ZBS49V0YS",{anonymize_ip:!0})</script>



<link rel="search" type="application/opensearchdescription+xml" title="Pendle Documentation" href="/opensearch.xml">




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.a54b6571.css">
<script src="/assets/js/runtime~main.02e36237.js" defer="defer"></script>
<script src="/assets/js/main.223c4566.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="24" height="24" viewBox="0 0 24 24" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12h18m-9-9h9m-9 18h9"></path></svg></button><a href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Pendle"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Pendle V2</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/pendle-v2/Introduction">Pendle V2 Docs</a></li><li><a href="https://pendle.gitbook.io/pendle-academy/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Pendle Academy<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Boros</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/boros-dev">Boros Dev Docs</a></li><li><a href="https://pendle.gitbook.io/boros/boros-docs" target="_blank" rel="noopener noreferrer" class="dropdown__link">Boros Docs<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://pendle.gitbook.io/boros" target="_blank" rel="noopener noreferrer" class="dropdown__link">Boros Academy<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="searchContainer_eKWQ"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button><div class="language-switcher" style="display:flex;align-items:center;margin-left:12px"><select style="background:rgba(248, 250, 252, 0.8);border:1px solid rgba(15, 23, 42, 0.1);border-radius:8px;padding:6px 12px;font-size:14px;color:#475569;cursor:pointer;min-width:80px"><option value="en" selected="">English</option><option value="cn">中文（中国)</option></select></div></div></div></div><div class="scrollProgressLine_ACL0"></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_cWv0"><aside class="theme-doc-sidebar-container docSidebarContainer_RSuS"><div class="sidebar_mhZE"><nav class="menu thin-scrollbar menu_Y1UP"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/boros-dev">📖 Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/boros-dev/LitePaper">📄 Lite Paper</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/boros-dev/HighLevelArchitecture">🏗️ High Level Architecture</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/boros-dev/Mechanics/OrderBook">⚙️ Mechanics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/boros-dev/Contracts/Router">📜 Contracts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/boros-dev/Backend/REST API">🔌 Backend Integration</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/boros-dev/FAQ">❓ FAQ</a></li></ul></nav></div></aside><main class="docMainContainer_hjYf"><div class="container padding-top--md padding-bottom--lg"><div><div class="row"><div class="col"><div><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">🏗️ High Level Architecture</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>High Level Architecture</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="core-contracts">Core Contracts<a href="#core-contracts" class="hash-link" aria-label="Direct link to Core Contracts" title="Direct link to Core Contracts">​</a></h2>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">graph TD</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Router --&gt; MarketHub</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    MarketHub --&gt; Market-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    MarketHub --&gt; Market-2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    MarketHub --&gt; Market-3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    MarketHub --&gt; ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    MarketHub --&gt; Market-n</span><br></span></code></pre></div></div>
<p>Router authenticates and forwards user operations to MarketHub.</p>
<p>MarketHub receives user operations from Router, forward to the correct market contract, settle fees/payment, and check that accounts fulfill the margin requirements.</p>
<p>Market executes user operations from MarketHub, then returns payment amount and data for margin checking.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="router">Router<a href="#router" class="hash-link" aria-label="Direct link to Router" title="Direct link to Router">​</a></h3>
<p>Router is the gateway to the Boros protocol. Its main functionality is authentication and authorization. Transactions can be sent to Router in two ways:</p>
<ul>
<li>Direct call where <code>msg.sender</code> is used as user address</li>
<li>Agent call where user signs messages of desired operations<!-- -->
<ul>
<li>Only available to Pendle&#x27;s permissioned relayers</li>
<li>Accessed through <a href="/boros-dev/Backend/SDK">Boros SDK</a></li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="markethub">MarketHub<a href="#markethub" class="hash-link" aria-label="Direct link to MarketHub" title="Direct link to MarketHub">​</a></h3>
<p>MarketHub is the market coordinator and risk manager of Boros. MarketHub holds user deposits and keeps track of users in the system and the markets that they have entered. Users are identified by MarketAcc, a custom type made of:</p>
<ul>
<li>user EVM address</li>
<li>subaccountID<!-- -->
<ul>
<li>Every user has up to 256 subaccounts, though only subaccount 0 is available to direct call</li>
</ul>
</li>
<li>tokenId<!-- -->
<ul>
<li>Every collateral token has a specific ID inside Boros. A given MarketAcc can only interact with markets of that collateral token.</li>
</ul>
</li>
<li>marketId<!-- -->
<ul>
<li>For isolated-margin account, this is the marketId of the market that this accounts operates on.</li>
<li>For cross-margin account, this is a special value <em>CROSS</em>, equal to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>24</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2^{24}-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">24</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">1</span></span></span></span>.</li>
</ul>
</li>
</ul>
<p>An account can enter a single market, if it is isolated, or multiple markets, if it is <em>CROSS</em>. Every market represents a different interest rate swap type: different token, different maturity, different reference rate. However, every market entered by a given account must share the same collateral token.</p>
<p>After each user operation, MarketHub checks that accounts fulfill the <a href="/boros-dev/Mechanics/Margin">margin requirements</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="market">Market<a href="#market" class="hash-link" aria-label="Direct link to Market" title="Direct link to Market">​</a></h3>
<p>Boros markets is deployed as separate contracts. Markets are differentiated by their descriptors:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">- bool isIsolatedOnly</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- TokenId tokenId</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- MarketId marketId</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- uint32 maturity</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- uint8 tickStep</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- uint16 iTickThresh</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- uint32 latestFTime</span><br></span></code></pre></div></div>
<p>Market provides an on-chain <a href="/boros-dev/Mechanics/OrderBook">central limit order book</a>, as well as over-the-counter (OTC) trading. For each user, market keeps track of position size and list of orders. When an order is filled, or an OTC trade is made, the position size is updated accordingly, and the fixed interest is paid upfront. Variable interest payments are paid on a fixed time period; the payment amount is determined by the accrual of the variable interest since last update, which is reported on-chain via an oracle.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="amm">AMM<a href="#amm" class="hash-link" aria-label="Direct link to AMM" title="Direct link to AMM">​</a></h3>
<p>Automated Market Makers (AMM) provide continuous liquidity alongside the order book. In Boros, AMMs are like normal accounts: they don&#x27;t have any special permissions except that they can perform OTC trades with users when requested. Router ensures optimal liquidity routing between AMMs and order book for best swap rate.</p>
<p>More details about AMM can be found in the <a href="https://github.com/pendle-finance/boros-core-public/blob/main/whitepapers/AMM.pdf" target="_blank" rel="noopener noreferrer">whitepaper</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="token-decimals">Token Decimals<a href="#token-decimals" class="hash-link" aria-label="Direct link to Token Decimals" title="Direct link to Token Decimals">​</a></h2>
<p>Internally, Boros uses 18-decimals fixed point for all numerical values, including position size, payment, fees, etc.</p>
<p>When depositing ERC20 tokens of non-18 decimals, the amount will be scaled up. Similarly, when withdrawing, the amount will be scaled down.</p>
<p>Tokens with decimal greater than 18 are not supported.</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/boros-dev/LitePaper"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">📄 Lite Paper</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/boros-dev/Mechanics/OrderBook"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">📊 Order Book</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#core-contracts" class="table-of-contents__link toc-highlight">Core Contracts</a><ul><li><a href="#router" class="table-of-contents__link toc-highlight">Router</a></li><li><a href="#markethub" class="table-of-contents__link toc-highlight">MarketHub</a></li><li><a href="#market" class="table-of-contents__link toc-highlight">Market</a></li><li><a href="#amm" class="table-of-contents__link toc-highlight">AMM</a></li></ul></li><li><a href="#token-decimals" class="table-of-contents__link toc-highlight">Token Decimals</a></li></ul></div></div></div></div></div></main></div></div></div><div class="background_hm_f"><div class="root_DvgA"><div class="linkGroup_Ckfr"><div class="linkGroupTitle_rRS_">Pages</div><a href="https://www.pendle.finance/" target="_blank">Website</a><a href="https://app.pendle.finance/market" target="_blank">App</a></div><div class="linkGroup_Ckfr"><div class="linkGroupTitle_rRS_">Socials</div><a href="https://discord.com/invite/EAujvncY2R" target="_blank">Discord</a><a href="https://twitter.com/pendle_fi/" target="_blank">Twitter</a><a href="https://t.me/pendlefinance/" target="_blank">Telegram</a></div><div class="linkGroup_Ckfr"><div class="linkGroupTitle_rRS_">About Us</div><a href="https://medium.com/pendle/" target="_blank">Medium</a><a href="https://angel.co/company/pendle_finance/" target="_blank">Careers</a><a href="https://pendle.finance/brandguide" target="_blank">Media Kit</a><a href="https://github.com/pendle-finance/pendle-core-v2-public/tree/master/audits" target="_blank">Audits</a></div></div></div></div>
</body>
</html>