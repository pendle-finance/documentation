<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-boros docs-version-current docs-doc-page docs-doc-id-HighLevelArchitecture" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">High Level Architecture | Pendle Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://pendle.finance/boros/HighLevelArchitecture"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-boros-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-boros-current"><meta data-rh="true" property="og:title" content="High Level Architecture | Pendle Documentation"><meta data-rh="true" name="description" content="Core Contracts"><meta data-rh="true" property="og:description" content="Core Contracts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://pendle.finance/boros/HighLevelArchitecture"><link data-rh="true" rel="alternate" href="https://pendle.finance/boros/HighLevelArchitecture" hreflang="en"><link data-rh="true" rel="alternate" href="https://pendle.finance/boros/HighLevelArchitecture" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://GFVY0GOMCR-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"High Level Architecture","item":"https://pendle.finance/boros/HighLevelArchitecture"}]}</script><link rel="search" type="application/opensearchdescription+xml" title="Pendle Documentation" href="/opensearch.xml">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.4effd50b.css">
<script src="/assets/js/runtime~main.a3dd127a.js" defer="defer"></script>
<script src="/assets/js/main.3e3c8627.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Pendle Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Pendle Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Pendle Documentation</b></a><a class="navbar__item navbar__link" href="/v2">V2</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/boros">Boros</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/boros">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/boros/LitePaper">Lite Paper</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/boros/HighLevelArchitecture">High Level Architecture</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/boros/Mechanics/OrderBook">Mechanics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/boros/Backend/REST API">Backend</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/boros/Contracts/Router">Contracts</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://github.com/pendle-finance/boros-core-public/tree/main/whitepapers" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK">Whitepapers<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://pendle.gitbook.io/boros" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK">Boros Academy<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">High Level Architecture</span></li></ul></nav><div class="theme-doc-markdown markdown"><header><h1>High Level Architecture</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="core-contracts">Core Contracts<a href="#core-contracts" class="hash-link" aria-label="Direct link to Core Contracts" title="Direct link to Core Contracts">​</a></h2>
<!-- -->
<p>Router authenticates and forwards user operations to MarketHub.</p>
<p>MarketHub receives user operations from Router, forward to the correct market contract, settle fees/payment, and check that accounts fulfill the margin requirements.</p>
<p>Market executes user operations from MarketHub, then returns payment amount and data for margin checking.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="router">Router<a href="#router" class="hash-link" aria-label="Direct link to Router" title="Direct link to Router">​</a></h3>
<p>Router is the gateway to the Boros protocol. Its main functionality is authentication and authorization. Transactions can be sent to Router in two ways:</p>
<ul>
<li>Direct call where <code>msg.sender</code> is used as user address</li>
<li>Agent call where user signs messages of desired operations<!-- -->
<ul>
<li>Only available to Pendle&#x27;s permissioned relayers</li>
<li>Accessed through <a href="/boros/Backend/SDK">Boros SDK</a></li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="markethub">MarketHub<a href="#markethub" class="hash-link" aria-label="Direct link to MarketHub" title="Direct link to MarketHub">​</a></h3>
<p>MarketHub is the market coordinator and risk manager of Boros. MarketHub holds user deposits and keeps track of users in the system and the markets that they have entered. Users are identified by MarketAcc, a custom type made of:</p>
<ul>
<li>user EVM address</li>
<li>subaccountID<!-- -->
<ul>
<li>Every user has up to 256 subaccounts, though only subaccount 0 is available to direct call</li>
</ul>
</li>
<li>tokenId<!-- -->
<ul>
<li>Every collateral token has a specific ID inside Boros. A given MarketAcc can only interact with markets of that collateral token.</li>
</ul>
</li>
<li>marketId<!-- -->
<ul>
<li>For isolated-margin account, this is the marketId of the market that this accounts operates on.</li>
<li>For cross-margin account, this is a special value <em>CROSS</em>, equal to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>24</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2^{24}-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">24</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">1</span></span></span></span>.</li>
</ul>
</li>
</ul>
<p>An account can enter a single market, if it is isolated, or multiple markets, if it is <em>CROSS</em>. Every market represents a different interest rate swap type: different token, different maturity, different reference rate. However, every market entered by a given account must share the same collateral token.</p>
<p>After each user operation, MarketHub checks that accounts fulfill the <a href="/boros/Mechanics/Margin">margin requirements</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="market">Market<a href="#market" class="hash-link" aria-label="Direct link to Market" title="Direct link to Market">​</a></h3>
<p>Boros markets is deployed as separate contracts. Markets are differentiated by their descriptors:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">- bool isIsolatedOnly</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- TokenId tokenId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- MarketId marketId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- uint32 maturity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- uint8 tickStep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- uint16 iTickThresh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- uint32 latestFTime</span><br></span></code></pre></div></div>
<p>Market provides an on-chain <a href="/boros/Mechanics/OrderBook">central limit order book</a>, as well as over-the-counter (OTC) trading. For each user, market keeps track of position size and list of orders. When an order is filled, or an OTC trade is made, the position size is updated accordingly, and the fixed interest is paid upfront. Variable interest payments are paid on a fixed time period; the payment amount is determined by the accrual of the variable interest since last update, which is reported on-chain via an oracle.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="amm">AMM<a href="#amm" class="hash-link" aria-label="Direct link to AMM" title="Direct link to AMM">​</a></h3>
<p>Automated Market Makers (AMM) provide continuous liquidity alongside the order book. In Boros, AMMs are like normal accounts: they don&#x27;t have any special permissions except that they can perform OTC trades with users when requested. Router ensures optimal liquidity routing between AMMs and order book for best swap rate.</p>
<p>More details about AMM can be found in the <a href="https://github.com/pendle-finance/boros-core-public/blob/main/whitepapers/AMM.pdf" target="_blank" rel="noopener noreferrer">whitepaper</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="token-decimals">Token Decimals<a href="#token-decimals" class="hash-link" aria-label="Direct link to Token Decimals" title="Direct link to Token Decimals">​</a></h2>
<p>Internally, Boros uses 18-decimals fixed point for all numerical values, including position size, payment, fees, etc.</p>
<p>When depositing ERC20 tokens of non-18 decimals, the amount will be scaled up. Similarly, when withdrawing, the amount will be scaled down.</p>
<p>Tokens with decimal greater than 18 are not supported.</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/boros/LitePaper"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Lite Paper</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/boros/Mechanics/OrderBook"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Order Book</div></a></nav></div></div></div></div></main></div></div></div><footer class="theme-layout-footer background_jo3k footer"><div class="root_ngte"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Pages</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://pendle.finance" target="_blank" rel="noopener noreferrer" class="linkGroup_OWBm">Website</a></li><li class="footer__item"><a href="https://app.pendle.finance" target="_blank" rel="noopener noreferrer" class="linkGroup_OWBm">V2</a></li><li class="footer__item"><a href="https://boros.pendle.finance" target="_blank" rel="noopener noreferrer" class="linkGroup_OWBm">Boros</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Socials</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/qshFxh6965/" target="_blank" rel="noopener noreferrer" class="linkGroup_OWBm">Discord</a></li><li class="footer__item"><a href="https://twitter.com/pendle_fi/" target="_blank" rel="noopener noreferrer" class="linkGroup_OWBm">Twitter</a></li><li class="footer__item"><a href="https://t.me/pendlefinance/" target="_blank" rel="noopener noreferrer" class="linkGroup_OWBm">Telegram</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">About Us</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://medium.com/pendle/" target="_blank" rel="noopener noreferrer" class="linkGroup_OWBm">Medium</a></li><li class="footer__item"><a href="https://angel.co/company/pendle_finance/" target="_blank" rel="noopener noreferrer" class="linkGroup_OWBm">Careers</a></li><li class="footer__item"><a href="https://www.pendle.finance/brandguide" target="_blank" rel="noopener noreferrer" class="linkGroup_OWBm">Media Kit</a></li><li class="footer__item"><a href="https://github.com/pendle-finance/boros-core-public/tree/main/audits/" target="_blank" rel="noopener noreferrer" class="linkGroup_OWBm">V2 Audits</a></li><li class="footer__item"><a href="https://github.com/pendle-finance/boros-core-public/tree/main/audits/" target="_blank" rel="noopener noreferrer" class="linkGroup_OWBm">Boros Audits</a></li></ul></div></div></div></div></footer></div>
</body>
</html>