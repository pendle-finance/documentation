<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-boros docs-version-current docs-doc-page docs-doc-id-Mechanics/OrderBook" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Central Limit Order Book | Pendle Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://pendle.finance/boros/Mechanics/OrderBook"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-boros-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-boros-current"><meta data-rh="true" property="og:title" content="Central Limit Order Book | Pendle Documentation"><meta data-rh="true" name="description" content="Boros implements a gas-optimized central limit order book (CLOB) specifically designed for the EVM. The order book architecture minimizes gas costs through lazy settlement and efficient data structures while maintaining the functionality expected from professional trading platforms."><meta data-rh="true" property="og:description" content="Boros implements a gas-optimized central limit order book (CLOB) specifically designed for the EVM. The order book architecture minimizes gas costs through lazy settlement and efficient data structures while maintaining the functionality expected from professional trading platforms."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://pendle.finance/boros/Mechanics/OrderBook"><link data-rh="true" rel="alternate" href="https://pendle.finance/boros/Mechanics/OrderBook" hreflang="en"><link data-rh="true" rel="alternate" href="https://pendle.finance/boros/Mechanics/OrderBook" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://GFVY0GOMCR-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Order Book","item":"https://pendle.finance/boros/Mechanics/OrderBook"}]}</script><link rel="search" type="application/opensearchdescription+xml" title="Pendle Documentation" href="/opensearch.xml">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.4effd50b.css">
<script src="/assets/js/runtime~main.a3dd127a.js" defer="defer"></script>
<script src="/assets/js/main.3e3c8627.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Pendle Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Pendle Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Pendle Documentation</b></a><a class="navbar__item navbar__link" href="/v2">V2</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/boros">Boros</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/boros">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/boros/LitePaper">Lite Paper</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/boros/HighLevelArchitecture">High Level Architecture</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/boros/Mechanics/OrderBook">Mechanics</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/boros/Mechanics/OrderBook">Order Book</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/boros/Mechanics/Settlement">Settlement</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/boros/Mechanics/Fees">Fees</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/boros/Mechanics/Margin">Margin</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/boros/Backend/REST API">Backend</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/boros/Contracts/Router">Contracts</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://github.com/pendle-finance/boros-core-public/tree/main/whitepapers" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK">Whitepapers<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://pendle.gitbook.io/boros" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK">Boros Academy<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Mechanics</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Order Book</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Central Limit Order Book</h1></header>
<p>Boros implements a gas-optimized central limit order book (CLOB) specifically designed for the EVM. The order book architecture minimizes gas costs through <a href="/boros/Mechanics/Settlement">lazy settlement</a> and efficient data structures while maintaining the functionality expected from professional trading platforms.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="order-book-structure">Order Book Structure<a href="#order-book-structure" class="hash-link" aria-label="Direct link to Order Book Structure" title="Direct link to Order Book Structure">​</a></h2>
<p>The order book consists of two independent sides:</p>
<ul>
<li><strong>Long Side (Bids)</strong>: Orders to buy/go long on interest rates</li>
<li><strong>Short Side (Asks)</strong>: Orders to sell/go short on interest rates</li>
</ul>
<p>Each side contains <strong>65,536 discrete rate levels</strong> (ticks) ranging from -32768 to 32767.</p>
<p>The tick system uses an exponential function to map discrete tick indices to interest rates. This design provides:</p>
<ul>
<li><strong>Compactness</strong>: Entire rate range expressed with just 16 bits</li>
<li><strong>Expressiveness</strong>: Finer granularity near zero, coarser at extremes</li>
<li><strong>Symmetry</strong>: Equal precision for positive and negative rates</li>
</ul>
<p>The tick spacing is configurable per market via the <code>tickStep</code> parameter. A larger <code>tickStep</code> creates wider rate intervals between ticks, suitable for more volatile markets.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="tick-to-rate-conversion">Tick to Rate Conversion<a href="#tick-to-rate-conversion" class="hash-link" aria-label="Direct link to Tick to Rate Conversion" title="Direct link to Tick to Rate Conversion">​</a></h2>
<p>The conversion between tick indices and interest rates follows an exponential formula:</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>rate</mtext><mo stretchy="false">(</mo><mtext>tick</mtext><mo stretchy="false">)</mo><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msup><mn>1.00005</mn><mrow><mtext>tick</mtext><mo>×</mo><mtext>tickStep</mtext></mrow></msup><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>if tick</mtext><mo>≥</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mo stretchy="false">(</mo><msup><mn>1.00005</mn><mrow><mo>−</mo><mtext>tick</mtext><mo>×</mo><mtext>tickStep</mtext></mrow></msup><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>if tick</mtext><mo>&lt;</mo><mn>0</mn></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">\text{rate}(\text{tick}) = \begin{cases}
1.00005^{\text{tick} \times \text{tickStep}} - 1 &amp; \text{if tick} \geq 0 \\
-(1.00005^{-\text{tick} \times \text{tickStep}} - 1) &amp; \text{if tick} &lt; 0
\end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord text"><span class="mord">rate</span></span><span class="mopen">(</span><span class="mord text"><span class="mord">tick</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em"></span><span class="minner"><span class="mopen delimcenter" style="top:0em"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em"><span style="top:-3.69em"><span class="pstrut" style="height:3.008em"></span><span class="mord"><span class="mord">1.0000</span><span class="mord"><span class="mord">5</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">tick</span></span><span class="mbin mtight">×</span><span class="mord text mtight"><span class="mord mtight">tickStep</span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord">1</span></span></span><span style="top:-2.25em"><span class="pstrut" style="height:3.008em"></span><span class="mord"><span class="mord">−</span><span class="mopen">(</span><span class="mord">1.0000</span><span class="mord"><span class="mord">5</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord text mtight"><span class="mord mtight">tick</span></span><span class="mbin mtight">×</span><span class="mord text mtight"><span class="mord mtight">tickStep</span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em"><span style="top:-3.69em"><span class="pstrut" style="height:3.008em"></span><span class="mord"><span class="mord text"><span class="mord">if tick</span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord">0</span></span></span><span style="top:-2.25em"><span class="pstrut" style="height:3.008em"></span><span class="mord"><span class="mord text"><span class="mord">if tick</span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>
<p>The TickMath library provides conversion between tick indices and interest rates:</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Convert tick to interest rate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin">int128</span><span class="token plain"> rate </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TickMath</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getRateAtTick</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tick</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tickStep</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Formula: rate = 1.00005^(tick * tickStep) - 1 for tick &gt;= 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//          rate = -(1.00005^(-tick * tickStep) - 1) for tick &lt; 0</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="examples">Examples<a href="#examples" class="hash-link" aria-label="Direct link to Examples" title="Direct link to Examples">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// tickStep = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tick = 0    -&gt; rate = 0% (neutral)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tick = 100  -&gt; rate =   1.00005^200 - 1  ≈  1.005%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tick = -100 -&gt; rate = -(1.00005^200 - 1) ≈ -1.005%</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="matching-priority">Matching Priority<a href="#matching-priority" class="hash-link" aria-label="Direct link to Matching Priority" title="Direct link to Matching Priority">​</a></h2>
<p>Boros order book follows the standard <strong>rate-time priority</strong> matching:</p>
<ul>
<li>Orders offering better rates are matched first<!-- -->
<ul>
<li>For long orders: Higher rates (willing to pay more) have priority</li>
<li>For short orders: Lower rates (willing to receive less) have priority</li>
</ul>
</li>
<li>Within the same rate level (tick), orders are matched in the order they were placed (FIFO)<!-- -->
<ul>
<li>The <code>orderIndex</code> within each tick determines the exact queue position</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="order-id">Order Id<a href="#order-id" class="hash-link" aria-label="Direct link to Order Id" title="Direct link to Order Id">​</a></h2>
<p>Each order in Boros has a unique order Id, which a 64-bit packed value containing order metadata:</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">OrderId structure </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">64</span><span class="token plain"> bits</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────┬──────────┬─────────────┬──────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ </span><span class="token function" style="color:#d73a49">Init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> │ </span><span class="token function" style="color:#d73a49">Side</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  │ </span><span class="token function" style="color:#d73a49">Tick</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">    │ </span><span class="token function" style="color:#d73a49">Index</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">40</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────┴──────────┴─────────────┴──────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Bit </span><span class="token number" style="color:#36acaa">63</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Initialization marker </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">always </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> valid orders</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Bit </span><span class="token number" style="color:#36acaa">56</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Side </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> LONG</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SHORT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Bits </span><span class="token number" style="color:#36acaa">40</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">55</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Encoded tick index</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Bits </span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">39</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Order index within tick</span><br></span></code></pre></div></div>
<p>This encoding has a nice ordering property: orders with <strong>lower OrderId values</strong> have <strong>higher priority</strong> in the order book.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="parsing-orderid">Parsing OrderId<a href="#parsing-orderid" class="hash-link" aria-label="Direct link to Parsing OrderId" title="Direct link to Parsing OrderId">​</a></h3>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Parsing an OrderId</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Side side</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">int16</span><span class="token plain"> tickIndex</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">uint40</span><span class="token plain"> orderIndex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> OrderIdLib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unpack</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">orderId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Quick access methods</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Side side </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> orderId</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">side</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin">int16</span><span class="token plain"> tick </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> orderId</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">tickIndex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin">uint40</span><span class="token plain"> index </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> orderId</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">orderIndex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="placing-orders">Placing orders<a href="#placing-orders" class="hash-link" aria-label="Direct link to Placing orders" title="Direct link to Placing orders">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="time-in-force">Time In Force<a href="#time-in-force" class="hash-link" aria-label="Direct link to Time In Force" title="Direct link to Time In Force">​</a></h3>
<p>Time In Force (TIF) parameters control how orders behave during matching and placement. Boros supports five TIF types to accommodate different trading strategies:</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> </span><span class="token class-name">TimeInForce</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GTC</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic">// Good Till Cancel - Standard limit order, remains on book until filled/cancelled</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IOC</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic">// Immediate or Cancel - Executes against available liquidity, cancels unfilled portion</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FOK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic">// Fill or Kill - Must fill entire size or transaction reverts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ALO</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic">// Add Liquidity Only - Post-only order, transaction reverts if would match</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SOFT_ALO   </span><span class="token comment" style="color:#999988;font-style:italic">// Soft ALO - If order would match, it gets skipped (not placed on orderbook) and transaction doesn&#x27;t revert</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="self-trade-prevention">Self-trade Prevention<a href="#self-trade-prevention" class="hash-link" aria-label="Direct link to Self-trade Prevention" title="Direct link to Self-trade Prevention">​</a></h3>
<p>Boros prevents self-trading by checking if an incoming order would match against the same account&#x27;s existing orders. If self-matching is detected, the transaction will revert to protect traders from unintentionally trading with themselves.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="restrictions">Restrictions<a href="#restrictions" class="hash-link" aria-label="Direct link to Restrictions" title="Direct link to Restrictions">​</a></h3>
<p><strong>Order Size</strong>:</p>
<ul>
<li>No minimum order size requirement</li>
<li>No lot size restrictions - any decimal amount supported</li>
<li>Orders must have non-zero size</li>
</ul>
<p><strong>Order Limits</strong>:</p>
<ul>
<li>Maximum <strong>100 open orders</strong> per account across all sides</li>
<li>Exceeding this limit will cause the transaction to revert</li>
</ul>
<p><strong>Rate Bounds</strong>:</p>
<ul>
<li>Orders with rates significantly deviating from the mark rate will be rejected:<!-- -->
<ul>
<li><strong>Buy/Long orders</strong>: Rejected if rate is too far above the mark rate</li>
<li><strong>Sell/Short orders</strong>: Rejected if rate is too far below the mark rate</li>
</ul>
</li>
<li>The acceptable deviation threshold is market-specific and configured to prevent market manipulation</li>
</ul>
<p><strong>Bad Debt Prevention</strong>:</p>
<ul>
<li>The system continuously monitors all open orders against account health</li>
<li>Orders that could potentially put makers into bad debt if filled are force-cancelled</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="twap-oracle">TWAP Oracle<a href="#twap-oracle" class="hash-link" aria-label="Direct link to TWAP Oracle" title="Direct link to TWAP Oracle">​</a></h2>
<p>Boros maintains a Time-Weighted Average Price (TWAP) oracle to calculate the <strong>mark rate</strong> - the reference rate used for margining and liquidations. Each time an order is matched against the order book. The rate of the last matched tick is incorporated into the TWAP calculation based on time elapsed.</p>
<p>The oracle uses a fixed-window observation approach:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">markRate = (lastTradedRate × timeElapsed + prevOracleRate × (window - timeElapsed)) / window</span><br></span></code></pre></div></div></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/boros/HighLevelArchitecture"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">High Level Architecture</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/boros/Mechanics/Settlement"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Settlement</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#order-book-structure" class="table-of-contents__link toc-highlight">Order Book Structure</a></li><li><a href="#tick-to-rate-conversion" class="table-of-contents__link toc-highlight">Tick to Rate Conversion</a><ul><li><a href="#examples" class="table-of-contents__link toc-highlight">Examples</a></li></ul></li><li><a href="#matching-priority" class="table-of-contents__link toc-highlight">Matching Priority</a></li><li><a href="#order-id" class="table-of-contents__link toc-highlight">Order Id</a><ul><li><a href="#parsing-orderid" class="table-of-contents__link toc-highlight">Parsing OrderId</a></li></ul></li><li><a href="#placing-orders" class="table-of-contents__link toc-highlight">Placing orders</a><ul><li><a href="#time-in-force" class="table-of-contents__link toc-highlight">Time In Force</a></li><li><a href="#self-trade-prevention" class="table-of-contents__link toc-highlight">Self-trade Prevention</a></li><li><a href="#restrictions" class="table-of-contents__link toc-highlight">Restrictions</a></li></ul></li><li><a href="#twap-oracle" class="table-of-contents__link toc-highlight">TWAP Oracle</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer background_jo3k footer"><div class="root_ngte"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Pages</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://pendle.finance" target="_blank" rel="noopener noreferrer" class="linkGroup_OWBm">Website</a></li><li class="footer__item"><a href="https://app.pendle.finance" target="_blank" rel="noopener noreferrer" class="linkGroup_OWBm">V2</a></li><li class="footer__item"><a href="https://boros.pendle.finance" target="_blank" rel="noopener noreferrer" class="linkGroup_OWBm">Boros</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Socials</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/qshFxh6965/" target="_blank" rel="noopener noreferrer" class="linkGroup_OWBm">Discord</a></li><li class="footer__item"><a href="https://twitter.com/pendle_fi/" target="_blank" rel="noopener noreferrer" class="linkGroup_OWBm">Twitter</a></li><li class="footer__item"><a href="https://t.me/pendlefinance/" target="_blank" rel="noopener noreferrer" class="linkGroup_OWBm">Telegram</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">About Us</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://medium.com/pendle/" target="_blank" rel="noopener noreferrer" class="linkGroup_OWBm">Medium</a></li><li class="footer__item"><a href="https://angel.co/company/pendle_finance/" target="_blank" rel="noopener noreferrer" class="linkGroup_OWBm">Careers</a></li><li class="footer__item"><a href="https://www.pendle.finance/brandguide" target="_blank" rel="noopener noreferrer" class="linkGroup_OWBm">Media Kit</a></li><li class="footer__item"><a href="https://github.com/pendle-finance/boros-core-public/tree/main/audits/" target="_blank" rel="noopener noreferrer" class="linkGroup_OWBm">V2 Audits</a></li><li class="footer__item"><a href="https://github.com/pendle-finance/boros-core-public/tree/main/audits/" target="_blank" rel="noopener noreferrer" class="linkGroup_OWBm">Boros Audits</a></li></ul></div></div></div></div></footer></div>
</body>
</html>