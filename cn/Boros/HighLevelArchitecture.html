<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Boros/HighLevelArchitecture" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">High Level Architecture | Pendle Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://pendle.finance/cn/Boros/HighLevelArchitecture"><meta data-rh="true" name="docusaurus_locale" content="cn"><meta data-rh="true" name="docsearch:language" content="cn"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="High Level Architecture | Pendle Documentation"><meta data-rh="true" name="description" content="Core Contracts"><meta data-rh="true" property="og:description" content="Core Contracts"><link data-rh="true" rel="icon" href="/cn/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://pendle.finance/cn/Boros/HighLevelArchitecture"><link data-rh="true" rel="alternate" href="https://pendle.finance/Boros/HighLevelArchitecture" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://pendle.finance/cn/Boros/HighLevelArchitecture" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://pendle.finance/Boros/HighLevelArchitecture" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://GFVY0GOMCR-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6ZBS49V0YS"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-6ZBS49V0YS",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Pendle Documentation" href="/cn/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><link rel="stylesheet" href="/cn/assets/css/styles.98172e72.css">
<link rel="preload" href="/cn/assets/js/runtime~main.481677bd.js" as="script">
<link rel="preload" href="/cn/assets/js/main.2d9fe7f6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div style="display:flex;flex-direction:column;align-items:center"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHidden_nLSi"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_DSK9"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中文（中国)</a><ul class="dropdown__menu"><li><a href="/Boros/HighLevelArchitecture" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en-US">English</a></li><li><a href="/cn/Boros/HighLevelArchitecture" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">中文（中国)</a></li></ul></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_W2AM"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage_qMb8"><main class="docMainContainer_RiV8 docMainContainerEnhanced_u7bj"><div class="container padding-top--md padding-bottom--lg"><div style="margin-top:2rem;max-width:900px;min-height:70vh"><div class="row"><div class="col"><div class="docItemContainer_Djhp"><article><div class="theme-doc-markdown markdown"><h1>High Level Architecture</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="core-contracts">Core Contracts<a href="#core-contracts" class="hash-link" aria-label="Direct link to Core Contracts" title="Direct link to Core Contracts">​</a></h2><div class="language-mermaid codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-mermaid codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">graph TD</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Router --&gt; MarketHub</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    MarketHub --&gt; Market-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    MarketHub --&gt; Market-2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    MarketHub --&gt; Market-3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    MarketHub --&gt; ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    MarketHub --&gt; Market-n</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Router authenticates and forwards user operations to MarketHub.</p><p>MarketHub receives user operations from Router, forward to the correct market contract, settle fees/payment, and check that accounts fulfill the margin requirements.</p><p>Market executes user operations from MarketHub, then returns payment amount and data for margin checking.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="router">Router<a href="#router" class="hash-link" aria-label="Direct link to Router" title="Direct link to Router">​</a></h3><p>Router is the gateway to the Boros protocol. Its main functionality is authentication and authorization. Transactions can be sent to Router in two ways:</p><ul><li>Direct call where <code>msg.sender</code> is used as user address</li><li>Agent call where user signs messages of desired operations<ul><li>Only available to Pendle&#x27;s permissioned relayers</li><li>Accessed through <a href="/cn/Boros/Backend/SDK">Boros SDK</a></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="markethub">MarketHub<a href="#markethub" class="hash-link" aria-label="Direct link to MarketHub" title="Direct link to MarketHub">​</a></h3><p>MarketHub is the market coordinator and risk manager of Boros. MarketHub holds user deposits and keeps track of users in the system and the markets that they have entered. Users are identified by MarketAcc, a custom type made of:</p><ul><li>user EVM address</li><li>subaccountID<ul><li>Every user has up to 256 subaccounts, though only subaccount 0 is available to direct call</li></ul></li><li>tokenId<ul><li>Every collateral token has a specific ID inside Boros. A given MarketAcc can only interact with markets of that collateral token.</li></ul></li><li>marketId<ul><li>For isolated-margin account, this is the marketId of the market that this accounts operates on.</li><li>For cross-margin account, this is a special value <em>CROSS</em>, equal to <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>24</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2^{24}-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">4</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">1</span></span></span></span></span>.</li></ul></li></ul><p>An account can enter a single market, if it is isolated, or multiple markets, if it is <em>CROSS</em>. Every market represents a different interest rate swap type: different token, different maturity, different reference rate. However, every market entered by a given account must share the same collateral token.</p><p>After each user operation, MarketHub checks that accounts fulfill the <a href="/cn/Boros/Mechanics/Margin">margin requirements</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="market">Market<a href="#market" class="hash-link" aria-label="Direct link to Market" title="Direct link to Market">​</a></h3><p>Boros markets is deployed as separate contracts. Markets are differentiated by their descriptors:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">- bool isIsolatedOnly</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- TokenId tokenId</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- MarketId marketId</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- uint32 maturity</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- uint8 tickStep</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- uint16 iTickThresh</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- uint32 latestFTime</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Market provides an on-chain <a href="/cn/Boros/Mechanics/OrderBook">central limit order book</a>, as well as over-the-counter (OTC) trading. For each user, market keeps track of position size and list of orders. When an order is filled, or an OTC trade is made, the position size is updated accordingly, and the fixed interest is paid upfront. Variable interest payments are paid on a fixed time period; the payment amount is determined by the accrual of the variable interest since last update, which is reported on-chain via an oracle.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="amm">AMM<a href="#amm" class="hash-link" aria-label="Direct link to AMM" title="Direct link to AMM">​</a></h3><p>Automated Market Makers (AMM) provide continuous liquidity alongside the order book. In Boros, AMMs are like normal accounts: they don&#x27;t have any special permissions except that they can perform OTC trades with users when requested. Router ensures optimal liquidity routing between AMMs and order book for best swap rate.</p><p>More details about AMM can be found in the <a href="https://github.com/pendle-finance/boros-core-public/blob/main/whitepapers/AMM.pdf" target="_blank" rel="noopener noreferrer">whitepaper</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="token-decimals">Token Decimals<a href="#token-decimals" class="hash-link" aria-label="Direct link to Token Decimals" title="Direct link to Token Decimals">​</a></h2><p>Internally, Boros uses 18-decimals fixed point for all numerical values, including position size, payment, fees, etc.</p><p>When depositing ERC20 tokens of non-18 decimals, the amount will be scaled up. Similarly, when withdrawing, the amount will be scaled down.</p><p>Tokens with decimal greater than 18 are not supported.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div></div></div></div></main></div></div><div class="background_hm_f"><div class="root_DvgA"><div class="linkGroup_Ckfr"><div class="linkGroupTitle_rRS_">Pages</div><a href="https://www.pendle.finance/" target="_blank">Website</a><a href="https://app.pendle.finance/market" target="_blank">App</a></div><div class="linkGroup_Ckfr"><div class="linkGroupTitle_rRS_">Socials</div><a href="https://discord.com/invite/EAujvncY2R" target="_blank">Discord</a><a href="https://twitter.com/pendle_fi/" target="_blank">Twitter</a><a href="https://t.me/pendlefinance/" target="_blank">Telegram</a></div><div class="linkGroup_Ckfr"><div class="linkGroupTitle_rRS_">About Us</div><a href="https://medium.com/pendle/" target="_blank">Medium</a><a href="https://angel.co/company/pendle_finance/" target="_blank">Careers</a><a href="https://pendle.finance/brandguide" target="_blank">Media Kit</a><a href="https://github.com/pendle-finance/pendle-core-v2-public/tree/master/audits" target="_blank">Audits</a></div></div></div></div></div>
<script src="/cn/assets/js/runtime~main.481677bd.js"></script>
<script src="/cn/assets/js/main.2d9fe7f6.js"></script>
</body>
</html>