"use strict";(self.webpackChunkpendle_documentation=self.webpackChunkpendle_documentation||[]).push([[277],{4120:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"Developers/Integration/PointsTracking","title":"Points & Rewards Tracking","description":"This guide covers how partner protocols can track and distribute points-based rewards (e.g., EigenLayer points, Renzo Miles, Ethena Sats) to Pendle users.","source":"@site/docs/pendle-v2/Developers/Integration/PointsTracking.md","sourceDirName":"Developers/Integration","slug":"/Developers/Integration/PointsTracking","permalink":"/cn/pendle-v2/Developers/Integration/PointsTracking","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"hide_table_of_contents":true},"sidebar":"myAutogeneratedSidebar","previous":{"title":"Community Listing","permalink":"/cn/pendle-v2/Developers/Integration/CommunityListing"},"next":{"title":"StandardizedYield (SY)","permalink":"/cn/pendle-v2/Developers/Contracts/StandardizedYield"}}');var r=i(4848),s=i(8453);const o={hide_table_of_contents:!0},l="Points & Rewards Tracking",d={},a=[{value:"Overview",id:"overview",level:2},{value:"The Balance Fetcher",id:"the-balance-fetcher",level:2},{value:"Core Functionality",id:"core-functionality",level:3},{value:"What It Handles",id:"what-it-handles",level:3},{value:"Partner Responsibility",id:"partner-responsibility",level:3},{value:"Points Calculation Logic",id:"points-calculation-logic",level:2},{value:"YT Holders",id:"yt-holders",level:3},{value:"LP Holders",id:"lp-holders",level:3},{value:"Calculating User Proportion (LP)",id:"calculating-user-proportion-lp",level:3},{value:"Calculating Total Point-Earning Position",id:"calculating-total-point-earning-position",level:3},{value:"Multipliers",id:"multipliers",level:3},{value:"Eligible Positions",id:"eligible-positions",level:2},{value:"LP Boost on Points",id:"lp-boost-on-points",level:2},{value:"External Reward Distribution",id:"external-reward-distribution",level:2},{value:"Merkl Integration",id:"merkl-integration",level:3},{value:"Direct Airdrops",id:"direct-airdrops",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"points--rewards-tracking",children:"Points & Rewards Tracking"})}),"\n",(0,r.jsx)(n.p,{children:"This guide covers how partner protocols can track and distribute points-based rewards (e.g., EigenLayer points, Renzo Miles, Ethena Sats) to Pendle users."}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"Many Pendle pools offer additional rewards in the form of points from integrated protocols. Pendle provides standardized tools to help partners manage the complexity of tracking points across YT holders, LP positions, and liquid lockers."}),"\n",(0,r.jsx)(n.h2,{id:"the-balance-fetcher",children:"The Balance Fetcher"}),"\n",(0,r.jsxs)(n.p,{children:["The recommended approach for tracking points is to use the ",(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"https://github.com/Pendle-Finance-Periphery/pendle-generic-balance-fetcher",children:(0,r.jsx)(n.code,{children:"pendle-generic-balance-fetcher"})})})," script."]}),"\n",(0,r.jsx)(n.h3,{id:"core-functionality",children:"Core Functionality"}),"\n",(0,r.jsxs)(n.p,{children:["The script returns a user's balance snapshot at a specific block height. The output is a mapping of ",(0,r.jsx)(n.code,{children:"user_address => implied_yield_share"}),", representing each user's proportional share of the underlying asset held in the SY contract."]}),"\n",(0,r.jsx)(n.h3,{id:"what-it-handles",children:"What It Handles"}),"\n",(0,r.jsx)(n.p,{children:"The balance fetcher correctly accounts for all of Pendle's internal nuances:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Factor"}),(0,r.jsx)(n.th,{children:"How it's handled"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"LP Boosting"})}),(0,r.jsx)(n.td,{children:"Applies the yield boost (up to 2.5x) for eligible stakers"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"YT Fee"})}),(0,r.jsx)(n.td,{children:"Accounts for the 5% fee applied to YT yields, allocated to the protocol"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Liquid Lockers"})}),(0,r.jsx)(n.td,{children:"Integrates with APIs from Penpie and Equilibria to track end-user balances within their contracts"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Post-Expiry"})}),(0,r.jsx)(n.td,{children:"Correctly attributes points for expired but unredeemed positions"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"partner-responsibility",children:"Partner Responsibility"}),"\n",(0,r.jsx)(n.p,{children:"The partner protocol is responsible for:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Running the balance fetcher script"}),"\n",(0,r.jsx)(n.li,{children:"Using the output to calculate the pro-rata distribution of points"}),"\n",(0,r.jsx)(n.li,{children:"Displaying it on their own dashboard"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Pendle does ",(0,r.jsx)(n.strong,{children:"not"})," handle the final distribution of partner points."]}),"\n",(0,r.jsx)(n.h2,{id:"points-calculation-logic",children:"Points Calculation Logic"}),"\n",(0,r.jsx)(n.h3,{id:"yt-holders",children:"YT Holders"}),"\n",(0,r.jsxs)(n.p,{children:["For point calculation purposes, ",(0,r.jsx)(n.strong,{children:"1 YT is treated as equivalent to 1 unit of the underlying SY asset"}),", regardless of the YT's market price. It earns the same amount of points as if you were holding the full underlying asset."]}),"\n",(0,r.jsxs)(n.p,{children:["A ",(0,r.jsx)(n.strong,{children:"5% fee"})," is applied to points earned from YT holdings. This fee is allocated to Pendle governance."]}),"\n",(0,r.jsx)(n.h3,{id:"lp-holders",children:"LP Holders"}),"\n",(0,r.jsxs)(n.p,{children:["For LPs, only the ",(0,r.jsx)(n.strong,{children:"SY portion"})," of the LP position earns points. The PT portion does not. The ratio of SY to PT within an LP position is dynamic and changes with every trade."]}),"\n",(0,r.jsxs)(n.p,{children:["No points fee is applied to LP positions. However, LP point earnings are influenced by the ",(0,r.jsx)(n.strong,{children:"LP boost"})," mechanism (up to 2.5x)."]}),"\n",(0,r.jsx)(n.h3,{id:"calculating-user-proportion-lp",children:"Calculating User Proportion (LP)"}),"\n",(0,r.jsxs)(n.p,{children:["A user's proportional share of a liquidity pool is calculated using ",(0,r.jsx)(n.code,{children:"activeBalance"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"User Proportion = activeBalance(user) / totalActiveSupply\n"})}),"\n",(0,r.jsx)(n.p,{children:"Query these values from the LP contract:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"LP_Contract.activeBalance(userAddress)"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"LP_Contract.totalActiveSupply()"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"calculating-total-point-earning-position",children:"Calculating Total Point-Earning Position"}),"\n",(0,r.jsx)(n.p,{children:"To find a user's total point-earning position, sum contributions from YT and LP:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Step 1: YT Contribution"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Get user's YT balance (e.g., 100 YT-ezETH)"}),"\n",(0,r.jsxs)(n.li,{children:["Apply 5% fee: ",(0,r.jsx)(n.code,{children:"100 \xd7 0.95 = 95"})]}),"\n",(0,r.jsxs)(n.li,{children:["Point-earning amount from YT = ",(0,r.jsx)(n.strong,{children:"95 ezETH"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Step 2: LP Contribution"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Calculate user's proportion using the ",(0,r.jsx)(n.code,{children:"activeBalance"})," formula above"]}),"\n",(0,r.jsxs)(n.li,{children:["Query total SY in LP: ",(0,r.jsx)(n.code,{children:"SY_Contract.balanceOf(LP_Contract_Address)"})]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"LP SY Share = User Proportion \xd7 Total SY in LP"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Step 3: Total"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Total Point-Earning Position = (YT Balance \xd7 0.95) + LP SY Share\n"})}),"\n",(0,r.jsx)(n.p,{children:"This final value (in terms of the underlying asset) is used to calculate the user's point allocation."}),"\n",(0,r.jsx)(n.h3,{id:"multipliers",children:"Multipliers"}),"\n",(0,r.jsxs)(n.p,{children:["Points programs often involve multiple layers of multipliers, which are ",(0,r.jsx)(n.strong,{children:"multiplicative"}),":"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example (Zircuit & Renzo Points):"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Zircuit Base: 1x for ETH, 2x for ezETH"}),"\n",(0,r.jsx)(n.li,{children:"Pendle Pool: 2x Zircuit multiplier, 1x Renzo multiplier"}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Effective Zircuit Points"}),": ",(0,r.jsx)(n.code,{children:"(2x ETH base) \xd7 (2x Pendle) = 4x"})," the base ETH emission rate"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Effective Renzo Points"}),": ",(0,r.jsx)(n.code,{children:"(1x Renzo base) \xd7 (1x Pendle) = 1x"})," the base Renzo emission rate"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"eligible-positions",children:"Eligible Positions"}),"\n",(0,r.jsx)(n.p,{children:"Points are allocated to positions with exposure to the underlying yield:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Position Type"}),(0,r.jsx)(n.th,{children:"Earns Points?"}),(0,r.jsx)(n.th,{children:"Notes"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"YT holders"})}),(0,r.jsx)(n.td,{children:"Yes"}),(0,r.jsx)(n.td,{children:"Full share (minus 5% fee) corresponding to 1 unit of the underlying asset per YT"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"LP holders"})}),(0,r.jsx)(n.td,{children:"Yes"}),(0,r.jsx)(n.td,{children:"Proportional to the SY portion of their LP position only"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Liquid locker holders"})}),(0,r.jsx)(n.td,{children:"Yes"}),(0,r.jsx)(n.td,{children:"Via Penpie, Equilibria, etc. \u2014 their underlying position is still an LP token"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"PT holders"})}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsx)(n.td,{children:"PT holders forgo all variable yield and points"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"lp-boost-on-points",children:"LP Boost on Points"}),"\n",(0,r.jsxs)(n.p,{children:["The up-to-2.5x boost applies to points earned by the ",(0,r.jsx)(n.strong,{children:"SY portion of an LP position"}),". It does ",(0,r.jsx)(n.strong,{children:"not"})," apply to points earned by holding YT."]}),"\n",(0,r.jsxs)(n.p,{children:["Boosting is a ",(0,r.jsx)(n.strong,{children:"zero-sum redistribution"})," of rewards within the LP pool. Boosting one user's share means other, non-boosted LPs receive a comparatively smaller share of the total points allocated to the pool's SY component."]}),"\n",(0,r.jsx)(n.h2,{id:"external-reward-distribution",children:"External Reward Distribution"}),"\n",(0,r.jsx)(n.h3,{id:"merkl-integration",children:"Merkl Integration"}),"\n",(0,r.jsxs)(n.p,{children:["For campaigns that use ",(0,r.jsx)(n.a,{href:"https://merkl.angle.money/",children:"Merkl"})," to distribute rewards, Pendle enables users to claim directly from the Merkl UI. The SY contract can be configured to claim rewards from Merkl and distribute them to end-users."]}),"\n",(0,r.jsx)(n.h3,{id:"direct-airdrops",children:"Direct Airdrops"}),"\n",(0,r.jsx)(n.p,{children:"Pendle can assist partners by providing necessary user balance data to facilitate direct airdrops. For rewards sent to liquid locker contracts, the liquid locker protocol is responsible for the final distribution."})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>l});var t=i(6540);const r={},s=t.createContext(r);function o(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);