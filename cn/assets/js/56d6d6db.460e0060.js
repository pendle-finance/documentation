"use strict";(self.webpackChunkpendle_documentation=self.webpackChunkpendle_documentation||[]).push([[816],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>k});var i=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=i.createContext({}),p=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=p(e.components);return i.createElement(s.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},m=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=p(n),m=a,k=d["".concat(s,".").concat(m)]||d[m]||c[m]||r;return n?i.createElement(k,o(o({ref:t},u),{},{components:n})):i.createElement(k,o({ref:t},u))}));function k(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:a,o[1]=l;for(var p=2;p<r;p++)o[p]=n[p];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}m.displayName="MDXCreateElement"},1599:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var i=n(7462),a=(n(7294),n(3905));const r={},o="Margin",l={unversionedId:"Boros/Mechanics/Margin",id:"Boros/Mechanics/Margin",title:"Margin",description:"Similar to other derivative exchanges, Boros supports both cross margin and isolated margin modes:",source:"@site/docs/Boros/Mechanics/Margin.md",sourceDirName:"Boros/Mechanics",slug:"/Boros/Mechanics/Margin",permalink:"/cn/Boros/Mechanics/Margin",draft:!1,tags:[],version:"current",frontMatter:{}},s={},p=[{value:"Position Value and Total Value",id:"position-value-and-total-value",level:2},{value:"Position Value",id:"position-value",level:3},{value:"Total Value",id:"total-value",level:3},{value:"Initial Margin",id:"initial-margin",level:2},{value:"Pre-scaling Initial Margin",id:"pre-scaling-initial-margin",level:3},{value:"Combined Initial Margin",id:"combined-initial-margin",level:3},{value:"Examples",id:"examples",level:4},{value:"Final Initial Margin",id:"final-initial-margin",level:3},{value:"Opening Position Requirements",id:"opening-position-requirements",level:3},{value:"Margin Check for Closing Orders",id:"margin-check-for-closing-orders",level:3},{value:"Maintenance Margin and Liquidation",id:"maintenance-margin-and-liquidation",level:2},{value:"Maintenance Margin",id:"maintenance-margin",level:3},{value:"Health Ratio",id:"health-ratio",level:3},{value:"Liquidation Process",id:"liquidation-process",level:3},{value:"Forced Deleverage",id:"forced-deleverage",level:3},{value:"Additional Restrictions",id:"additional-restrictions",level:2},{value:"Hard Open Interest Cap",id:"hard-open-interest-cap",level:3},{value:"Closing Only Mode",id:"closing-only-mode",level:3}],u={toc:p},d="wrapper";function c(e){let{components:t,...n}=e;return(0,a.kt)(d,(0,i.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"margin"},"Margin"),(0,a.kt)("p",null,"Similar to other derivative exchanges, Boros supports both cross margin and isolated margin modes:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Cross Margin"),": Enables maximum capital efficiency by sharing collateral across multiple markets within the same collateral zone. A single collateral deposit can back positions across all markets in the zone, allowing unrealized profits in one market to offset potential losses in another.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Isolated Margin"),": Constrains collateral to a single market, providing position-level risk isolation. Liquidations in an isolated market only affect that specific position and do not impact other isolated positions or cross-margin positions."))),(0,a.kt)("p",null,"This document covers the essential concepts of Boros margin system. For complete specifications, please refer to the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/pendle-finance/boros-core-public/blob/main/whitepapers/Boros.pdf"},"Boros whitepaper"),"."),(0,a.kt)("h2",{id:"position-value-and-total-value"},"Position Value and Total Value"),(0,a.kt)("h3",{id:"position-value"},"Position Value"),(0,a.kt)("p",null,"The position value represents the current unrealized profit or loss of an interest rate swap position:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Position Value = Position Size \xd7 Mark Rate \xd7 Time to Maturity\n")),(0,a.kt)("h3",{id:"total-value"},"Total Value"),(0,a.kt)("p",null,"A user's total value across all positions is calculated as:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Total Value = Account Cash + \u03a3(Position Values across all markets)\n")),(0,a.kt)("p",null,"This total value determines the user's available margin for new positions and liquidation risk."),(0,a.kt)("h2",{id:"initial-margin"},"Initial Margin"),(0,a.kt)("p",null,"Initial margin requirements must be satisfied when opening new positions to ensure sufficient collateral backing."),(0,a.kt)("h3",{id:"pre-scaling-initial-margin"},"Pre-scaling Initial Margin"),(0,a.kt)("p",null,"The pre-scaling initial margin (PIM) for each component is calculated as:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Pre-scaling IM = |Size| \xd7 max(|Rate|, Rate Threshold)\n")),(0,a.kt)("p",null,"Where ",(0,a.kt)("inlineCode",{parentName:"p"},"Rate Threshold")," is a market parameter that sets the minimum rate used for margin calculations."),(0,a.kt)("h3",{id:"combined-initial-margin"},"Combined Initial Margin"),(0,a.kt)("p",null,"The system combines initial margin requirements from:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Active Position"),": Existing standalone position."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Long Orders"),": Unfilled buy orders"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Short Orders"),": Unfilled sell orders")),(0,a.kt)("p",null,"PIM for active position is using with mark rate. PIM for orders are calculated using order rates."),(0,a.kt)("p",null,"The calculation evaluates worst-case margin requirements for both long and short sides:"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Long-side Pre-scaling IM:")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"If current position is SHORT and total long order sizes \u2264 |short position size|: Long PIM = 0 (orders only reduce position)"),(0,a.kt)("li",{parentName:"ul"},"Otherwise: Long PIM = Sum of long orders' PIM + position PIM (adjusted for direction)")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Short-side Pre-scaling IM:")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"If current position is LONG and total short order sizes \u2264 |long position size|: Short PIM = 0 (orders only reduce position)"),(0,a.kt)("li",{parentName:"ul"},"Otherwise: Short PIM = Sum of short orders' PIM + position PIM (adjusted for direction)")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Final Pre-scaling IM")," = max(Long-side PIM, Short-side PIM)"),(0,a.kt)("p",null,"This ensures sufficient margin for the worst-case scenario where all orders on one side get filled."),(0,a.kt)("h4",{id:"examples"},"Examples"),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"Note: For simplicity, these examples ignore the rate threshold parameter and use the actual rates directly.")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Example 1: Long position with additional long orders")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Current position: LONG 1000 units at mark rate 5%"),(0,a.kt)("li",{parentName:"ul"},"Open orders: LONG 500 units at 4.5%"),(0,a.kt)("li",{parentName:"ul"},"Position PIM = 1000 \xd7 5% = 50"),(0,a.kt)("li",{parentName:"ul"},"Long orders PIM = 500 \xd7 4.5% = 22.5"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Long-side PIM")," = 50 + 22.5 = 72.5 (position and orders add up)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Short-side PIM")," = 0 (no short orders)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Final PIM")," = 72.5")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Example 2: Long position with small short orders (not enough to flip position)")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Current position: LONG 1000 units at mark rate 5%"),(0,a.kt)("li",{parentName:"ul"},"Open orders: SHORT 600 units at 5.5%"),(0,a.kt)("li",{parentName:"ul"},"Position PIM = 1000 \xd7 5% = 50"),(0,a.kt)("li",{parentName:"ul"},"Short orders PIM = 600 \xd7 5.5% = 33"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Long-side PIM")," = 50 (no long orders)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Short-side PIM")," = 0 (600 < 1000, orders only reduce position)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Final PIM")," = 50")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Example 3: Long position with large short orders (can flip position)")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Current position: LONG 1000 units at mark rate 5%"),(0,a.kt)("li",{parentName:"ul"},"Open orders: SHORT 2500 units at 6%"),(0,a.kt)("li",{parentName:"ul"},"Position PIM = 1000 \xd7 5% = 50"),(0,a.kt)("li",{parentName:"ul"},"Short orders PIM = 2500 \xd7 6% = 150"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Long-side PIM")," = 50 (no long orders)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Short-side PIM")," = 150 - 50 = 100"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Final PIM")," = 100 (Short-side PIM is larger)")),(0,a.kt)("h3",{id:"final-initial-margin"},"Final Initial Margin"),(0,a.kt)("p",null,"The actual initial margin requirement scales the pre-scaling amount:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Initial Margin = Pre-scaling IM \xd7 IM Factor \xd7 Personal Factor \xd7 max(Time to Maturity, Time Threshold)\n")),(0,a.kt)("h3",{id:"opening-position-requirements"},"Opening Position Requirements"),(0,a.kt)("p",null,"To open new positions:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Total Initial Margin (all markets) \u2264 User's Total Value\n")),(0,a.kt)("h3",{id:"margin-check-for-closing-orders"},"Margin Check for Closing Orders"),(0,a.kt)("p",null,'When initial margin requirements are not met, users can still place orders under "closing-only" conditions:'),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Position Size Reduction"),": Orders must reduce absolute position size (no position flipping)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"No Opposite Side Orders"),": Cannot place orders on the opposite side of existing position"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Rate Bounds"),": Closing rate must be within reasonable bounds from mark rate")),(0,a.kt)("p",null,"These relaxed conditions allow users to reduce risk even when under-collateralized."),(0,a.kt)("h2",{id:"maintenance-margin-and-liquidation"},"Maintenance Margin and Liquidation"),(0,a.kt)("h3",{id:"maintenance-margin"},"Maintenance Margin"),(0,a.kt)("p",null,"Maintenance margin represents the minimum collateral required to keep positions open:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Maintenance Margin = |Position Size| \xd7 max(|Mark Rate|, Rate Threshold) \xd7 MM Factor \xd7 max(Time to Maturity, Time Threshold)\n")),(0,a.kt)("h3",{id:"health-ratio"},"Health Ratio"),(0,a.kt)("p",null,"A user's health ratio indicates their margin safety:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Health Ratio = Total Value / Total Maintenance Margin\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Health Ratio > 1"),": Position is healthy"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Health Ratio \u2264 1"),": Position is eligible for liquidation")),(0,a.kt)("h3",{id:"liquidation-process"},"Liquidation Process"),(0,a.kt)("p",null,"When a user's total value drops below maintenance margin requirements, their position becomes eligible for liquidation. Liquidation is a permissioned action carried out by Pendle to maintain protocol solvency."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Liquidation Mechanics:")),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Position is closed (partially or fully) at current mark rate"),(0,a.kt)("li",{parentName:"ol"},"Liquidator takes over the closed position"),(0,a.kt)("li",{parentName:"ol"},"Liquidation incentive is transferred from liquidated user to liquidator")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Liquidation Incentive:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Liquidation Incentive = min(Incentive Factor, Health Ratio) \xd7 Change in Maintenance Margin\n")),(0,a.kt)("p",null,"Where the ",(0,a.kt)("strong",{parentName:"p"},"Incentive Factor")," is calculated as:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Incentive Factor = Base Factor + Slope Factor \xd7 (1 - Health Ratio)\n")),(0,a.kt)("p",null,"This structure provides larger incentives as positions become more distressed, encouraging timely liquidation."),(0,a.kt)("h3",{id:"forced-deleverage"},"Forced Deleverage"),(0,a.kt)("p",null,"When insufficient liquidity exists for normal liquidation and a user's health ratio continues declining to ",(0,a.kt)("strong",{parentName:"p"},"0.7"),", the system performs forced deleverage as a last resort."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Deleverage Process:")),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Identifies accounts with opposite-side positions (typically highest leverage)"),(0,a.kt)("li",{parentName:"ol"},"Forces a swap between distressed account and counterparty at mark rate"),(0,a.kt)("li",{parentName:"ol"},"Total value across accounts remains unchanged"),(0,a.kt)("li",{parentName:"ol"},"Maintenance margin requirements decrease, restoring account health")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Important Notes:")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Forced deleverage is an emergency mechanism to protect protocol solvency"),(0,a.kt)("li",{parentName:"ul"},"This action is not expected to occur frequently under normal market conditions"),(0,a.kt)("li",{parentName:"ul"},"Priority targets are high-leverage positions on the opposite side")),(0,a.kt)("h2",{id:"additional-restrictions"},"Additional Restrictions"),(0,a.kt)("h3",{id:"hard-open-interest-cap"},"Hard Open Interest Cap"),(0,a.kt)("p",null,"Boros implements a hard cap on total open interest to limit system-wide risk:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Total Open Interest \u2264 Hard OI Cap\n")),(0,a.kt)("p",null,'When the system approaches this limit, "Closing only" mode may be activated for risk management.'),(0,a.kt)("h3",{id:"closing-only-mode"},"Closing Only Mode"),(0,a.kt)("p",null,"Markets can enter closing-only mode during high-risk conditions. In this mode:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Only orders that reduce position size are allowed"),(0,a.kt)("li",{parentName:"ul"},"New position opening is prohibited"),(0,a.kt)("li",{parentName:"ul"},"Market makers may be whitelisted to continue providing liquidity")))}c.isMDXComponent=!0}}]);