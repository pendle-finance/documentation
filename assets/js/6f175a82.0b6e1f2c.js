"use strict";(self.webpackChunkpendle_documentation=self.webpackChunkpendle_documentation||[]).push([[4767],{2721:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"Mechanics/Margin","title":"Margin","description":"Similar to other derivative exchanges, Boros supports both cross margin and isolated margin modes:","source":"@site/docs/boros-dev-docs/Mechanics/Margin.mdx","sourceDirName":"Mechanics","slug":"/Mechanics/Margin","permalink":"/boros-dev/Mechanics/Margin","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"borosSidebar","previous":{"title":"\ud83d\udcca Order Book","permalink":"/boros-dev/Mechanics/OrderBook"},"next":{"title":"\u2705 Settlement","permalink":"/boros-dev/Mechanics/Settlement"}}');var r=n(4848),o=n(8453);const t={},l="Margin",a={},d=[{value:"Position Value and Total Value",id:"position-value-and-total-value",level:2},{value:"Position Value",id:"position-value",level:3},{value:"Total Value",id:"total-value",level:3},{value:"Initial Margin",id:"initial-margin",level:2},{value:"Pre-scaling Initial Margin",id:"pre-scaling-initial-margin",level:3},{value:"Combined Initial Margin",id:"combined-initial-margin",level:3},{value:"Examples",id:"examples",level:4},{value:"Final Initial Margin",id:"final-initial-margin",level:3},{value:"Opening Position Requirements",id:"opening-position-requirements",level:3},{value:"Margin Check for Closing Orders",id:"margin-check-for-closing-orders",level:3},{value:"Maintenance Margin and Liquidation",id:"maintenance-margin-and-liquidation",level:2},{value:"Maintenance Margin",id:"maintenance-margin",level:3},{value:"Health Ratio",id:"health-ratio",level:3},{value:"Liquidation Process",id:"liquidation-process",level:3},{value:"Forced Deleverage",id:"forced-deleverage",level:3},{value:"Additional Restrictions",id:"additional-restrictions",level:2},{value:"Hard Open Interest Cap",id:"hard-open-interest-cap",level:3},{value:"Closing Only Mode",id:"closing-only-mode",level:3}];function c(e){const i={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"margin",children:"Margin"})}),"\n",(0,r.jsx)(i.p,{children:"Similar to other derivative exchanges, Boros supports both cross margin and isolated margin modes:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Cross Margin"}),": Enables maximum capital efficiency by sharing collateral across multiple markets within the same collateral zone. A single collateral deposit can back positions across all markets in the zone, allowing unrealized profits in one market to offset potential losses in another."]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Isolated Margin"}),": Constrains collateral to a single market, providing position-level risk isolation. Liquidations in an isolated market only affect that specific position and do not impact other isolated positions or cross-margin positions."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(i.p,{children:["This document covers the essential concepts of Boros margin system. For complete specifications, please refer to the ",(0,r.jsx)(i.a,{href:"https://github.com/pendle-finance/boros-core-public/blob/main/whitepapers/Boros.pdf",children:"Boros whitepaper"}),"."]}),"\n",(0,r.jsx)(i.h2,{id:"position-value-and-total-value",children:"Position Value and Total Value"}),"\n",(0,r.jsx)(i.h3,{id:"position-value",children:"Position Value"}),"\n",(0,r.jsx)(i.p,{children:"The position value represents the current unrealized profit or loss of an interest rate swap position:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"Position Value = Position Size \xd7 Mark Rate \xd7 Time to Maturity\n"})}),"\n",(0,r.jsx)(i.h3,{id:"total-value",children:"Total Value"}),"\n",(0,r.jsx)(i.p,{children:"A user's total value across all positions is calculated as:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"Total Value = Account Cash + \u03a3(Position Values across all markets)\n"})}),"\n",(0,r.jsx)(i.p,{children:"This total value determines the user's available margin for new positions and liquidation risk."}),"\n",(0,r.jsx)(i.h2,{id:"initial-margin",children:"Initial Margin"}),"\n",(0,r.jsx)(i.p,{children:"Initial margin requirements must be satisfied when opening new positions to ensure sufficient collateral backing."}),"\n",(0,r.jsx)(i.h3,{id:"pre-scaling-initial-margin",children:"Pre-scaling Initial Margin"}),"\n",(0,r.jsx)(i.p,{children:"The pre-scaling initial margin (PIM) for each component is calculated as:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"Pre-scaling IM = |Size| \xd7 max(|Rate|, Rate Threshold)\n"})}),"\n",(0,r.jsxs)(i.p,{children:["Where ",(0,r.jsx)(i.code,{children:"Rate Threshold"})," is a market parameter that sets the minimum rate used for margin calculations."]}),"\n",(0,r.jsx)(i.h3,{id:"combined-initial-margin",children:"Combined Initial Margin"}),"\n",(0,r.jsx)(i.p,{children:"The system combines initial margin requirements from:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Active Position"}),": Existing standalone position."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Long Orders"}),": Unfilled buy orders"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Short Orders"}),": Unfilled sell orders"]}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:"PIM for active position is using with mark rate. PIM for orders are calculated using order rates."}),"\n",(0,r.jsx)(i.p,{children:"The calculation evaluates worst-case margin requirements for both long and short sides:"}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Long-side Pre-scaling IM:"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"If current position is SHORT and total long order sizes \u2264 |short position size|: Long PIM = 0 (orders only reduce position)"}),"\n",(0,r.jsx)(i.li,{children:"Otherwise: Long PIM = Sum of long orders' PIM + position PIM (adjusted for direction)"}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Short-side Pre-scaling IM:"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"If current position is LONG and total short order sizes \u2264 |long position size|: Short PIM = 0 (orders only reduce position)"}),"\n",(0,r.jsx)(i.li,{children:"Otherwise: Short PIM = Sum of short orders' PIM + position PIM (adjusted for direction)"}),"\n"]}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Final Pre-scaling IM"})," = max(Long-side PIM, Short-side PIM)"]}),"\n",(0,r.jsx)(i.p,{children:"This ensures sufficient margin for the worst-case scenario where all orders on one side get filled."}),"\n",(0,r.jsx)(i.h4,{id:"examples",children:"Examples"}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.em,{children:"Note: For simplicity, these examples ignore the rate threshold parameter and use the actual rates directly."})}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Example 1: Long position with additional long orders"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Current position: LONG 1000 units at mark rate 5%"}),"\n",(0,r.jsx)(i.li,{children:"Open orders: LONG 500 units at 4.5%"}),"\n",(0,r.jsx)(i.li,{children:"Position PIM = 1000 \xd7 5% = 50"}),"\n",(0,r.jsx)(i.li,{children:"Long orders PIM = 500 \xd7 4.5% = 22.5"}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Long-side PIM"})," = 50 + 22.5 = 72.5 (position and orders add up)"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Short-side PIM"})," = 0 (no short orders)"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Final PIM"})," = 72.5"]}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Example 2: Long position with small short orders (not enough to flip position)"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Current position: LONG 1000 units at mark rate 5%"}),"\n",(0,r.jsx)(i.li,{children:"Open orders: SHORT 600 units at 5.5%"}),"\n",(0,r.jsx)(i.li,{children:"Position PIM = 1000 \xd7 5% = 50"}),"\n",(0,r.jsx)(i.li,{children:"Short orders PIM = 600 \xd7 5.5% = 33"}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Long-side PIM"})," = 50 (no long orders)"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Short-side PIM"})," = 0 (600 < 1000, orders only reduce position)"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Final PIM"})," = 50"]}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Example 3: Long position with large short orders (can flip position)"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Current position: LONG 1000 units at mark rate 5%"}),"\n",(0,r.jsx)(i.li,{children:"Open orders: SHORT 2500 units at 6%"}),"\n",(0,r.jsx)(i.li,{children:"Position PIM = 1000 \xd7 5% = 50"}),"\n",(0,r.jsx)(i.li,{children:"Short orders PIM = 2500 \xd7 6% = 150"}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Long-side PIM"})," = 50 (no long orders)"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Short-side PIM"})," = 150 - 50 = 100"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Final PIM"})," = 100 (Short-side PIM is larger)"]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"final-initial-margin",children:"Final Initial Margin"}),"\n",(0,r.jsx)(i.p,{children:"The actual initial margin requirement scales the pre-scaling amount:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"Initial Margin = Pre-scaling IM \xd7 IM Factor \xd7 Personal Factor \xd7 max(Time to Maturity, Time Threshold)\n"})}),"\n",(0,r.jsx)(i.h3,{id:"opening-position-requirements",children:"Opening Position Requirements"}),"\n",(0,r.jsx)(i.p,{children:"To open new positions:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"Total Initial Margin (all markets) \u2264 User's Total Value\n"})}),"\n",(0,r.jsx)(i.h3,{id:"margin-check-for-closing-orders",children:"Margin Check for Closing Orders"}),"\n",(0,r.jsx)(i.p,{children:'When initial margin requirements are not met, users can still place orders under "closing-only" conditions:'}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Position Size Reduction"}),": Orders must reduce absolute position size (no position flipping)"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"No Opposite Side Orders"}),": Cannot place orders on the opposite side of existing position"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Rate Bounds"}),": Closing rate must be within reasonable bounds from mark rate"]}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:"These relaxed conditions allow users to reduce risk even when under-collateralized."}),"\n",(0,r.jsx)(i.h2,{id:"maintenance-margin-and-liquidation",children:"Maintenance Margin and Liquidation"}),"\n",(0,r.jsx)(i.h3,{id:"maintenance-margin",children:"Maintenance Margin"}),"\n",(0,r.jsx)(i.p,{children:"Maintenance margin represents the minimum collateral required to keep positions open:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"Maintenance Margin = |Position Size| \xd7 max(|Mark Rate|, Rate Threshold) \xd7 MM Factor \xd7 max(Time to Maturity, Time Threshold)\n"})}),"\n",(0,r.jsx)(i.h3,{id:"health-ratio",children:"Health Ratio"}),"\n",(0,r.jsx)(i.p,{children:"A user's health ratio indicates their margin safety:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"Health Ratio = Total Value / Total Maintenance Margin\n"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Health Ratio > 1"}),": Position is healthy"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Health Ratio \u2264 1"}),": Position is eligible for liquidation"]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"liquidation-process",children:"Liquidation Process"}),"\n",(0,r.jsx)(i.p,{children:"When a user's total value drops below maintenance margin requirements, their position becomes eligible for liquidation. Liquidation is a permissioned action carried out by Pendle to maintain protocol solvency."}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Liquidation Mechanics:"})}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsx)(i.li,{children:"Position is closed (partially or fully) at current mark rate"}),"\n",(0,r.jsx)(i.li,{children:"Liquidator takes over the closed position"}),"\n",(0,r.jsx)(i.li,{children:"Liquidation incentive is transferred from liquidated user to liquidator"}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Liquidation Incentive:"})}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"Liquidation Incentive = min(Incentive Factor, Health Ratio) \xd7 Change in Maintenance Margin\n"})}),"\n",(0,r.jsxs)(i.p,{children:["Where the ",(0,r.jsx)(i.strong,{children:"Incentive Factor"})," is calculated as:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"Incentive Factor = Base Factor + Slope Factor \xd7 (1 - Health Ratio)\n"})}),"\n",(0,r.jsx)(i.p,{children:"This structure provides larger incentives as positions become more distressed, encouraging timely liquidation."}),"\n",(0,r.jsx)(i.h3,{id:"forced-deleverage",children:"Forced Deleverage"}),"\n",(0,r.jsxs)(i.p,{children:["When insufficient liquidity exists for normal liquidation and a user's health ratio continues declining to ",(0,r.jsx)(i.strong,{children:"0.7"}),", the system performs forced deleverage as a last resort."]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Deleverage Process:"})}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsx)(i.li,{children:"Identifies accounts with opposite-side positions (typically highest leverage)"}),"\n",(0,r.jsx)(i.li,{children:"Forces a swap between distressed account and counterparty at mark rate"}),"\n",(0,r.jsx)(i.li,{children:"Total value across accounts remains unchanged"}),"\n",(0,r.jsx)(i.li,{children:"Maintenance margin requirements decrease, restoring account health"}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Important Notes:"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Forced deleverage is an emergency mechanism to protect protocol solvency"}),"\n",(0,r.jsx)(i.li,{children:"This action is not expected to occur frequently under normal market conditions"}),"\n",(0,r.jsx)(i.li,{children:"Priority targets are high-leverage positions on the opposite side"}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"additional-restrictions",children:"Additional Restrictions"}),"\n",(0,r.jsx)(i.h3,{id:"hard-open-interest-cap",children:"Hard Open Interest Cap"}),"\n",(0,r.jsx)(i.p,{children:"Boros implements a hard cap on total open interest to limit system-wide risk:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"Total Open Interest \u2264 Hard OI Cap\n"})}),"\n",(0,r.jsx)(i.p,{children:'When the system approaches this limit, "Closing only" mode may be activated for risk management.'}),"\n",(0,r.jsx)(i.h3,{id:"closing-only-mode",children:"Closing Only Mode"}),"\n",(0,r.jsx)(i.p,{children:"Markets can enter closing-only mode during high-risk conditions. In this mode:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Only orders that reduce position size are allowed"}),"\n",(0,r.jsx)(i.li,{children:"New position opening is prohibited"}),"\n",(0,r.jsx)(i.li,{children:"Market makers may be whitelisted to continue providing liquidity"}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,o.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,i,n)=>{n.d(i,{R:()=>t,x:()=>l});var s=n(6540);const r={},o=s.createContext(r);function t(e){const i=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(o.Provider,{value:i},e.children)}}}]);