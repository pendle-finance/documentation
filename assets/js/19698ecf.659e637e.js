"use strict";(self.webpackChunkpendle_documentation=self.webpackChunkpendle_documentation||[]).push([[1574],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),d=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=d(e.components);return a.createElement(s.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),c=d(n),u=r,h=c["".concat(s,".").concat(u)]||c[u]||m[u]||i;return n?a.createElement(h,o(o({ref:t},p),{},{components:n})):a.createElement(h,o({ref:t},p))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[c]="string"==typeof e?e:r,o[1]=l;for(var d=2;d<i;d++)o[d]=n[d];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},8271:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>l,toc:()=>d});var a=n(7462),r=(n(7294),n(3905));const i={hide_table_of_contents:!0},o="High Level Architecture",l={unversionedId:"Developers/HighLevelArchitecture",id:"Developers/HighLevelArchitecture",title:"High Level Architecture",description:"High Level Architecture",source:"@site/docs/Developers/HighLevelArchitecture.md",sourceDirName:"Developers",slug:"/Developers/HighLevelArchitecture",permalink:"/Developers/HighLevelArchitecture",draft:!1,tags:[],version:"current",frontMatter:{hide_table_of_contents:!0},sidebar:"myAutogeneratedSidebar",previous:{title:"Developer FAQ",permalink:"/Developers/DeveloperFAQ"},next:{title:"PendleRouter",permalink:"/Developers/Contracts/PendleRouter"}},s={},d=[{value:"Functions of Contracts",id:"functions-of-contracts",level:2},{value:"StandardizedY Yield (SY)",id:"standardizedy-yield-sy",level:3},{value:"Principal Token (PT)",id:"principal-token-pt",level:3},{value:"Yield Token (YT)",id:"yield-token-yt",level:3},{value:"PendleMarket",id:"pendlemarket",level:3},{value:"PendleGauge",id:"pendlegauge",level:3},{value:"VotingController",id:"votingcontroller",level:3},{value:"GaugeController",id:"gaugecontroller",level:3},{value:"vePENDLE",id:"vependle",level:3},{value:"PendleRouter",id:"pendlerouter",level:3}],p={toc:d},c="wrapper";function m(e){let{components:t,...i}=e;return(0,r.kt)(c,(0,a.Z)({},p,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"high-level-architecture"},"High Level Architecture"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"High Level Architecture",src:n(4813).Z,title:"High Level Architecture",width:"2250",height:"1376"})),(0,r.kt)("h2",{id:"functions-of-contracts"},"Functions of Contracts"),(0,r.kt)("h3",{id:"standardizedy-yield-sy"},"StandardizedY Yield (SY)"),(0,r.kt)("p",null,"SY is a wrapped version of the interest-bearing token (ibToken) that can also be staked into other protocols to earn even more interest. In the Pendle system, SY is used instead of the ibToken for all operations, including trading on PendleMarket or minting Principal Token & Yield Token."),(0,r.kt)("p",null,"The following are true:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"center"},"SY"),(0,r.kt)("th",{parentName:"tr",align:"center"},"ibToken (1 SY = 1 ib Token)"),(0,r.kt)("th",{parentName:"tr",align:"center"},"Asset (ibToken appreciates against)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"SY GLP"),(0,r.kt)("td",{parentName:"tr",align:"center"},(0,r.kt)("inlineCode",{parentName:"td"},"GLP")),(0,r.kt)("td",{parentName:"tr",align:"center"},"NIL, GLP doesn't appreciate")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"SY sfrxETH"),(0,r.kt)("td",{parentName:"tr",align:"center"},(0,r.kt)("inlineCode",{parentName:"td"},"sfrxETH")),(0,r.kt)("td",{parentName:"tr",align:"center"},"frxETH")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"SY wstETH"),(0,r.kt)("td",{parentName:"tr",align:"center"},(0,r.kt)("inlineCode",{parentName:"td"},"wstETH")),(0,r.kt)("td",{parentName:"tr",align:"center"},"stETH")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"SY rETH-WETH_BalancerLP Aura"),(0,r.kt)("td",{parentName:"tr",align:"center"},(0,r.kt)("inlineCode",{parentName:"td"},"rETH-WETH LP")," of Balancer staked into the corresponding Aura's gauge"),(0,r.kt)("td",{parentName:"tr",align:"center"},"Liquidity of rETH-WETH pool")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"SY PENDLE-ETH_Camelot"),(0,r.kt)("td",{parentName:"tr",align:"center"},(0,r.kt)("inlineCode",{parentName:"td"},"PENDLE-ETH LP")," of Camelot staked into the corresponding NFT Pool & Nitro Pool"),(0,r.kt)("td",{parentName:"tr",align:"center"},"Liquidity of PENDLE-ETH pool")))),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"SY wstETH was mistakenly named SY stETH on deployment.")),(0,r.kt)("h3",{id:"principal-token-pt"},"Principal Token (PT)"),(0,r.kt)("p",null,"PT is a token that represents the right to redeem for the principal amount at maturity, and is tradable on PendleMarket. While PT represents a claim to a fixed amount of assets, SY wraps an ibToken that increases in value, meaning that ",(0,r.kt)("inlineCode",{parentName:"p"},"1 PT != 1 SY")," is always true (except in exceptional cases). Instead, ",(0,r.kt)("inlineCode",{parentName:"p"},"1 PT = 1 Asset"),', where "Asset" refers to what SY\'s ibToken is denominated in.'),(0,r.kt)("p",null,"The following are true:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"center"},"PT"),(0,r.kt)("th",{parentName:"tr",align:"center"},"Asset (1 PT = 1 Asset)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"PT GLP"),(0,r.kt)("td",{parentName:"tr",align:"center"},"GLP")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"PT sfrxETH"),(0,r.kt)("td",{parentName:"tr",align:"center"},"frxETH")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"PT wstETH"),(0,r.kt)("td",{parentName:"tr",align:"center"},"stETH")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"PT rETH-WETH_BalancerLP Aura"),(0,r.kt)("td",{parentName:"tr",align:"center"},"1 liquidity of rETH-WETH pool")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"PT PENDLE-ETH_Camelot"),(0,r.kt)("td",{parentName:"tr",align:"center"},"1 liquidity of PENDLE-ETH pool")))),(0,r.kt)("p",null,"At redemption, ",(0,r.kt)("inlineCode",{parentName:"p"},"1 PT = X SY"),", where ",(0,r.kt)("span",{parentName:"p",className:"math math-inline"},(0,r.kt)("span",{parentName:"span",className:"katex"},(0,r.kt)("span",{parentName:"span",className:"katex-mathml"},(0,r.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,r.kt)("semantics",{parentName:"math"},(0,r.kt)("mrow",{parentName:"semantics"},(0,r.kt)("mi",{parentName:"mrow"},"X")),(0,r.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"X")))),(0,r.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"0.68333em",verticalAlign:"0em"}}),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.07847em"}},"X")))))," satisfies the condition that ",(0,r.kt)("inlineCode",{parentName:"p"},"X SY = 1 Asset"),"."),(0,r.kt)("h3",{id:"yield-token-yt"},"Yield Token (YT)"),(0,r.kt)("p",null,"YT is a token that represents the rights to redeem the interest generated by the SY until it reaches maturity. It's important to note that the value of YT is zero once it reaches maturity. The yield can be redeemed at any time and it can be traded on PendleMarket using special methods. ibToken generates yield in two forms, which Pendle denotes as:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Interest")," (compounding yield): The yield is denominated in the same unit as the ibToken. For example, as time goes on, ",(0,r.kt)("inlineCode",{parentName:"li"},"wstETH")," becomes worth more in terms of ",(0,r.kt)("inlineCode",{parentName:"li"},"stETH"),", and ",(0,r.kt)("inlineCode",{parentName:"li"},"rETH-WETH LP")," becomes worth more in terms of ",(0,r.kt)("inlineCode",{parentName:"li"},"liquidity"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Rewards")," (yield that does not compound): The yield is given out in a different unit than the ibToken. For example, ",(0,r.kt)("inlineCode",{parentName:"li"},"rETH-WETH LP")," generates both ",(0,r.kt)("inlineCode",{parentName:"li"},"BAL")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"AURA"),", while ",(0,r.kt)("inlineCode",{parentName:"li"},"GLP")," generates ",(0,r.kt)("inlineCode",{parentName:"li"},"ETH"),".")),(0,r.kt)("p",null,"The following are true:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"center"},"YT"),(0,r.kt)("th",{parentName:"tr",align:"center"},"Interest"),(0,r.kt)("th",{parentName:"tr",align:"center"},"Rewards"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"YT GLP"),(0,r.kt)("td",{parentName:"tr",align:"center"},"-"),(0,r.kt)("td",{parentName:"tr",align:"center"},"ETH")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"YT sfrxETH"),(0,r.kt)("td",{parentName:"tr",align:"center"},"frxETH"),(0,r.kt)("td",{parentName:"tr",align:"center"},"-")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"YT wstETH"),(0,r.kt)("td",{parentName:"tr",align:"center"},"stETH"),(0,r.kt)("td",{parentName:"tr",align:"center"},"-")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"YT rETH-WETH_BalancerLP Aura"),(0,r.kt)("td",{parentName:"tr",align:"center"},"liquidity of rETH-WETH pool"),(0,r.kt)("td",{parentName:"tr",align:"center"},"AURA, BAL")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"YT PENDLE-ETH_Camelot"),(0,r.kt)("td",{parentName:"tr",align:"center"},"liquidity of PENDLE-ETH pool"),(0,r.kt)("td",{parentName:"tr",align:"center"},"GRAIL, PENDLE")))),(0,r.kt)("p",null,"PT and YT are minted and redeemed using the YT contract. To mint PT and YT, SY is utilized. ",(0,r.kt)("inlineCode",{parentName:"p"},"1 SY = X PT + X YT")," is created where ",(0,r.kt)("inlineCode",{parentName:"p"},"1 SY = X Asset"),". Prior to maturity, both PT and YT must be provided to redeem the underlying SY. After maturity, only PT is required for redemption."),(0,r.kt)("h3",{id:"pendlemarket"},"PendleMarket"),(0,r.kt)("p",null,"PendleMarket (or simply Market) is a contract that enables users to trade between PT and its corresponding SY, while still allowing liquidity provision as usual. Swap fees are directly compounded into the LP. Each Market also has its own built-in geometric-mean oracle, similar to UniswapV3."),(0,r.kt)("p",null,"Currently, there is no market to trade YT, but it is always tradable by the following algorithms: "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"SY \u279d YT")," = flashswap SY, mint PT & YT, payback PT, send YT to users."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"YT \u279d SY")," = flashswap PT, use PT & YT, redeem SY, pay back, send excess to users.")),(0,r.kt)("h3",{id:"pendlegauge"},"PendleGauge"),(0,r.kt)("p",null,"PendleGauge is a contract that distributes PENDLE and other rewards generated by SY to Market LP holders. Each Gauge is directly embedded into the corresponding Market, so there is no need to stake LP to receive these rewards. It's important to note that rewards can be redeemed at any time."),(0,r.kt)("p",null,"The rewards are not distributed based on the amount of LP holdings, but rather on the ",(0,r.kt)("strong",{parentName:"p"},"activeBalance"),". The ",(0,r.kt)("strong",{parentName:"p"},"activeBalance")," is calculated as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-solidity"},"activeBalance = min(userLpBalance, userBoostedBalance);\nuserBoostedBalance = 0.4 * userLpBalance + 0.6 * totalLpSupply * userVePendleBalance/ totalVePendleSupply;\n")),(0,r.kt)("h3",{id:"votingcontroller"},"VotingController"),(0,r.kt)("p",null,"The VotingController is a contract that allows users to utilize their vePENDLE to vote for markets. This voting process determines the amount of PENDLE each market will receive in the following epoch. Each epoch lasts for one week, beginning at ",(0,r.kt)("strong",{parentName:"p"},"0:00 UTC on Thursday")," and ending at the same time on the following Thursday. During the epoch, users can change their vote as desired, but the vote will only become finalized when the epoch ends."),(0,r.kt)("h3",{id:"gaugecontroller"},"GaugeController"),(0,r.kt)("p",null,"The GaugeController is a contract that receives the voting results from the VotingController and distributes PENDLE to the Gauges accordingly. The PENDLE for the epoch is not distributed all at once, but instead is released every second throughout the epoch."),(0,r.kt)("h3",{id:"vependle"},"vePENDLE"),(0,r.kt)("p",null,"The vePENDLE contract allows users to lock their PENDLE in order to receive vePENDLE. Each user's position is represented by a pair of values: ",(0,r.kt)("inlineCode",{parentName:"p"},"(amount, expiry)"),". After the ",(0,r.kt)("inlineCode",{parentName:"p"},"expiry"),", the user can withdraw their ",(0,r.kt)("inlineCode",{parentName:"p"},"amount")," of PENDLE from the contract. The balance of a user's vePENDLE will decay weekly until it becomes zero at expiry."),(0,r.kt)("h3",{id:"pendlerouter"},"PendleRouter"),(0,r.kt)("p",null,"PendleRouter is a contract that aggregates callers' actions with various different SYs, PTs, YTs, and Markets. It is not owned, immutable, and does not have any special permissions or whitelists on any contracts it interacts with. For this reason, any third-party protocols can freely embed the router's logic into their code for better gas efficiency."),(0,r.kt)("p",null,"The Router is also a ",(0,r.kt)("strong",{parentName:"p"},"static")," Diamond-Proxy (ERC2535) contract without any upgrade functions as described in this ",(0,r.kt)("a",{parentName:"p",href:"https://twitter.com/mudgen/status/1630229952523272195/"},"tweet"),". A summary for ERC2535 is that there can be multiple implementation contracts for a single proxy, with each function (or set of functions) delegatecall to its own implementation."),(0,r.kt)("p",null,"To interact easily with the PendleRouter, please refer to: ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/pendle-finance/pendle-core-v2-public/blob/main/contracts/interfaces/IPAllAction.sol"},"https://github.com/pendle-finance/pendle-core-v2-public/blob/main/contracts/interfaces/IPAllAction.sol")),(0,r.kt)("p",null,"For a list of all the functions that can be called on the Router, users can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"IPAllAction ABI")," and call it on the Router address, which will resolve the call accordingly."),(0,r.kt)("p",null,"You can read more about the PendleRouter ",(0,r.kt)("a",{parentName:"p",href:"/Developers/Contracts/PendleRouter"},"here"),"."))}m.isMDXComponent=!0},4813:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/high_level_architecture-457bcdd55f399a2d90b8c7bd9e2b6a09.png"}}]);