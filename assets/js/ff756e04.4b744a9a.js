"use strict";(self.webpackChunkpendle_documentation=self.webpackChunkpendle_documentation||[]).push([[6612],{993:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>c,toc:()=>l});const c=JSON.parse('{"id":"Backend/websocket","title":"Boros WebSocket","description":"This guide explains how to directly connect to Boros\'s WebSocket service using Socket.IO client.","source":"@site/docs/boros-dev-docs/Backend/4. websocket.mdx","sourceDirName":"Backend","slug":"/Backend/websocket","permalink":"/boros-dev/Backend/websocket","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{},"sidebar":"borosSidebar","previous":{"title":"\ud83c\udf10 API","permalink":"/boros-dev/Backend/api"},"next":{"title":"\u2728 Best Practices","permalink":"/boros-dev/Backend/best-practices"}}');var s=t(4848),o=t(8453);const r={},i="Boros WebSocket",a={},l=[{value:"Basic Usage",id:"basic-usage",level:2},{value:"Connection Events",id:"connection-events",level:2},{value:"Handling Connection",id:"handling-connection",level:3},{value:"Subscribing to Channels",id:"subscribing-to-channels",level:2},{value:"Cleanup",id:"cleanup",level:2},{value:"Channel Types",id:"channel-types",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Example Implementation",id:"example-implementation",level:2},{value:"Account Change Tracking",id:"account-change-tracking",level:2},{value:"Subscribing to Account Updates",id:"subscribing-to-account-updates",level:3},{value:"Recommended Pattern",id:"recommended-pattern",level:3},{value:"Current Limitations",id:"current-limitations",level:3},{value:"Complete Account Tracking Example",id:"complete-account-tracking-example",level:3},{value:"Error Handling",id:"error-handling",level:2}];function d(e){const n={blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"boros-websocket",children:"Boros WebSocket"})}),"\n",(0,s.jsx)(n.p,{children:"This guide explains how to directly connect to Boros's WebSocket service using Socket.IO client."}),"\n",(0,s.jsx)(n.h2,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,s.jsx)(n.p,{children:"Here's a complete example of how to connect to and use the WebSocket:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"import { io } from 'socket.io-client';\n\n// Initialize the socket connection\nconst socket = io('wss://api.boros.finance/pendle-dapp-v3', {\n  path: '/socket/socket.io',\n  reconnectionAttempts: 5,\n  transports: ['websocket']\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"connection-events",children:"Connection Events"}),"\n",(0,s.jsx)(n.h3,{id:"handling-connection",children:"Handling Connection"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"socket.on('connect', () => {\n  console.log('Connected to WebSocket server');\n});\n\nsocket.on('disconnect', () => {\n  console.log('Disconnected from WebSocket server');\n});\n\nsocket.on('connect_error', (error) => {\n  console.error('Connection error:', error);\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"subscribing-to-channels",children:"Subscribing to Channels"}),"\n",(0,s.jsx)(n.p,{children:"To receive updates, you need to:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Subscribe to a channel"}),"\n",(0,s.jsx)(n.li,{children:"Listen for updates on that channel"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"// Subscribe to a channel\nsocket.emit('subscribe', 'statistics:MARKET_ID');\n\n// Listen for updates\nsocket.on('statistics:MARKET_ID:update', (data) => {\n  console.log('Received market statistics update:', data);\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"cleanup",children:"Cleanup"}),"\n",(0,s.jsx)(n.p,{children:"Always clean up your WebSocket connections when they're no longer needed:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"function cleanup() {\n  // Unsubscribe from channels\n  socket.emit('unsubscribe', 'statistics:MARKET_ID');\n\n  // Remove listeners\n  socket.off('statistics:MARKET_ID:update');\n\n  // Disconnect\n  socket.disconnect();\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"channel-types",children:"Channel Types"}),"\n",(0,s.jsx)(n.p,{children:"Common channel patterns:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Channel"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"orderbook:MARKET_ID:TICK_SIZE"})}),(0,s.jsxs)(n.td,{children:["Orderbook updates for the given market. Accepted TICK_SIZE values: ",(0,s.jsx)(n.code,{children:"0.1"}),", ",(0,s.jsx)(n.code,{children:"0.01"}),", ",(0,s.jsx)(n.code,{children:"0.001"}),", ",(0,s.jsx)(n.code,{children:"0.0001"}),", ",(0,s.jsx)(n.code,{children:"0.00001"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"market-trade:MARKET_ID"})}),(0,s.jsx)(n.td,{children:"Market trade updates"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"statistics:MARKET_ID"})}),(0,s.jsx)(n.td,{children:"Market statistics updates"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"account:ACCOUNT"})}),(0,s.jsx)(n.td,{children:"Account state change notifications (orders, positions, balances)"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["Replace ",(0,s.jsx)(n.code,{children:"MARKET_ID"})," with your specific market identifier, ",(0,s.jsx)(n.code,{children:"USER_ADDRESS"})," with the wallet address, and ",(0,s.jsx)(n.code,{children:"ACCOUNT_ID"})," with the sub-account ID (default: ",(0,s.jsx)(n.code,{children:"0"}),")."]}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Connection Management"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Always handle connection errors"}),"\n",(0,s.jsx)(n.li,{children:"Implement reconnection logic if needed"}),"\n",(0,s.jsx)(n.li,{children:"Clean up connections when no longer needed"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Event Handling"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Subscribe to channels after connection is established"}),"\n",(0,s.jsx)(n.li,{children:"Remove listeners before disconnecting"}),"\n",(0,s.jsx)(n.li,{children:"Handle potential errors in data processing"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Resource Management"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Unsubscribe from channels you no longer need"}),"\n",(0,s.jsx)(n.li,{children:"Don't create multiple connections unnecessarily"}),"\n",(0,s.jsx)(n.li,{children:"Clean up resources when your application closes"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"example-implementation",children:"Example Implementation"}),"\n",(0,s.jsx)(n.p,{children:"Here's a complete example putting it all together:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"import { io } from 'socket.io-client';\n\nclass PendleWebSocket {\n  private socket: any;\n\n  constructor() {\n    this.socket = io('wss://secrettune.io/pendle-dapp-v3', {\n      path: '/socket.io',\n      reconnectionAttempts: 5,\n      transports: ['websocket']\n    });\n\n    this.setupEventHandlers();\n  }\n\n  private setupEventHandlers() {\n    this.socket.on('connect', () => {\n      console.log('Connected to WebSocket server');\n    });\n\n    this.socket.on('disconnect', () => {\n      console.log('Disconnected from WebSocket server');\n    });\n\n    this.socket.on('connect_error', (error) => {\n      console.error('Connection error:', error);\n    });\n  }\n\n  public subscribeToMarket(marketId: string) {\n    const channel = `statistics:${marketId}`;\n    this.socket.emit('subscribe', channel);\n\n    this.socket.on(`${channel}:update`, (data) => {\n      console.log(`Received update for ${marketId}:`, data);\n    });\n  }\n\n  public unsubscribeFromMarket(marketId: string) {\n    const channel = `statistics:$\\{marketId\\}`;\n    this.socket.emit('unsubscribe', channel);\n    this.socket.off(`${channel}:update`);\n  }\n\n  public disconnect() {\n    this.socket.disconnect();\n  }\n}\n\n// Usage example:\nconst ws = new PendleWebSocket();\nws.subscribeToMarket('YOUR_MARKET_ID');\n\n// Clean up when done\n// ws.unsubscribeFromMarket('YOUR_MARKET_ID');\n// ws.disconnect();\n"})}),"\n",(0,s.jsx)(n.h2,{id:"account-change-tracking",children:"Account Change Tracking"}),"\n",(0,s.jsx)(n.p,{children:"You can subscribe to your account channel to receive notifications when your account state changes (e.g., order fills, position updates, balance changes)."}),"\n",(0,s.jsx)(n.h3,{id:"subscribing-to-account-updates",children:"Subscribing to Account Updates"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Subscribe to account updates\n// Format: account:USER_ADDRESS:ACCOUNT_ID\nsocket.emit('subscribe', 'account:0xYourWalletAddress:0');\n\n// Listen for account update events\nsocket.on('account:0xYourWalletAddress:0:update', (data) => {\n  console.log('Account updated:', data);\n\n  // Refetch the latest account data via API\n  refreshAccountData();\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"recommended-pattern",children:"Recommended Pattern"}),"\n",(0,s.jsxs)(n.p,{children:["When you receive an account update event, ",(0,s.jsx)(n.strong,{children:"refetch the relevant API endpoints"})," to get the complete updated state:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'import axios from "axios";\nimport { MarketAccLib, CROSS_MARKET_ID } from "@pendle/sdk-boros";\n\nasync function refreshAccountData() {\n  const marketAcc = MarketAccLib.pack(walletAddress, accountId, tokenId, CROSS_MARKET_ID);\n\n  // Refetch account info\n  const { data: accountInfo } = await axios.post(\n    `${API_BASE_URL}/open-api/v1/accounts/market-acc-infos`,\n    { marketAccs: [marketAcc] }\n  );\n\n  // Refetch active orders\n  const { data: orders } = await axios.get(\n    `${API_BASE_URL}/open-api/v1/accounts/limit-orders`,\n    {\n      params: {\n        userAddress: walletAddress,\n        accountId: accountId,\n        isActive: true,\n      },\n    }\n  );\n\n  // Update your local state\n  updateLocalState(accountInfo, orders);\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"current-limitations",children:"Current Limitations"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note:"})," Currently, account update events serve as notifications that ",(0,s.jsx)(n.em,{children:"something"})," has changed, but do not include the full details of the change in the event payload. You need to call the REST API to fetch the updated data."]}),"\n",(0,s.jsx)(n.p,{children:"We are planning to enhance these WebSocket events to include more detailed data in future updates, reducing the need for additional API calls."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"complete-account-tracking-example",children:"Complete Account Tracking Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { io } from 'socket.io-client';\nimport axios from \"axios\";\n\nclass AccountTracker {\n  private socket: any;\n  private walletAddress: string;\n  private accountId: number;\n\n  constructor(walletAddress: string, accountId: number = 0) {\n    this.walletAddress = walletAddress;\n    this.accountId = accountId;\n\n    this.socket = io('wss://api.boros.finance/pendle-dapp-v3', {\n      path: '/socket/socket.io',\n      reconnectionAttempts: 5,\n      transports: ['websocket']\n    });\n\n    this.setupConnection();\n  }\n\n  private setupConnection() {\n    this.socket.on('connect', () => {\n      console.log('Connected - subscribing to account updates');\n      this.subscribeToAccount();\n    });\n\n    this.socket.on('disconnect', () => {\n      console.log('Disconnected from WebSocket');\n    });\n  }\n\n  private subscribeToAccount() {\n    const channel = `account:${this.walletAddress}:${this.accountId}`;\n    this.socket.emit('subscribe', channel);\n\n    this.socket.on(`${channel}:update`, async (data) => {\n      console.log('Account change detected:', data);\n\n      // Fetch updated data from API\n      await this.refreshAccountData();\n    });\n  }\n\n  private async refreshAccountData() {\n    try {\n      // Fetch latest account state\n      const { data } = await axios.post(\n        'https://api.boros.finance/open-api/v1/accounts/market-acc-infos',\n        { marketAccs: [/* your marketAcc */] }\n      );\n\n      console.log('Updated account data:', data);\n      // Process updated data...\n    } catch (error) {\n      console.error('Failed to refresh account data:', error);\n    }\n  }\n\n  public disconnect() {\n    const channel = `account:${this.walletAddress}:${this.accountId}`;\n    this.socket.emit('unsubscribe', channel);\n    this.socket.off(`${channel}:update`);\n    this.socket.disconnect();\n  }\n}\n\n// Usage\nconst tracker = new AccountTracker('0xYourWalletAddress', 0);\n\n// Clean up when done\n// tracker.disconnect();\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,s.jsx)(n.p,{children:"Always implement proper error handling:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"socket.on('connect_error', (error) => {\n  console.error('Connection failed:', error);\n  // Implement your error handling logic\n});\n\nsocket.on('error', (error) => {\n  console.error('Socket error:', error);\n  // Implement your error handling logic\n});\n"})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>i});var c=t(6540);const s={},o=c.createContext(s);function r(e){const n=c.useContext(o);return c.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),c.createElement(o.Provider,{value:n},e.children)}}}]);