"use strict";(self.webpackChunkpendle_documentation=self.webpackChunkpendle_documentation||[]).push([[9046],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>h});var i=a(7294);function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function n(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(Object(a),!0).forEach((function(t){l(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function r(e,t){if(null==e)return{};var a,i,l=function(e,t){if(null==e)return{};var a,i,l={},n=Object.keys(e);for(i=0;i<n.length;i++)a=n[i],t.indexOf(a)>=0||(l[a]=e[a]);return l}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(i=0;i<n.length;i++)a=n[i],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(l[a]=e[a])}return l}var s=i.createContext({}),c=function(e){var t=i.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},u=function(e){var t=c(e.components);return i.createElement(s.Provider,{value:t},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},m=i.forwardRef((function(e,t){var a=e.components,l=e.mdxType,n=e.originalType,s=e.parentName,u=r(e,["components","mdxType","originalType","parentName"]),d=c(a),m=l,h=d["".concat(s,".").concat(m)]||d[m]||p[m]||n;return a?i.createElement(h,o(o({ref:t},u),{},{components:a})):i.createElement(h,o({ref:t},u))}));function h(e,t){var a=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var n=a.length,o=new Array(n);o[0]=m;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r[d]="string"==typeof e?e:l,o[1]=r;for(var c=2;c<n;c++)o[c]=a[c];return i.createElement.apply(null,o)}return i.createElement.apply(null,a)}m.displayName="MDXCreateElement"},7717:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>p,frontMatter:()=>n,metadata:()=>r,toc:()=>c});var i=a(7462),l=(a(7294),a(3905));const n={hide_table_of_contents:!0},o="PT as Collateral in a Money Market",r={unversionedId:"Developers/Oracles/PTAsCollateral",id:"Developers/Oracles/PTAsCollateral",title:"PT as Collateral in a Money Market",description:"PTs are good collaterals in a money market since it is a fixed rate position (or a zero coupon bond) on an asset. This document discusses the use cases for PT as a collateral, as well as considerations for a money market when integrating PT as a collateral.",source:"@site/docs/Developers/Oracles/PTAsCollateral.md",sourceDirName:"Developers/Oracles",slug:"/Developers/Oracles/PTAsCollateral",permalink:"/Developers/Oracles/PTAsCollateral",draft:!1,tags:[],version:"current",frontMatter:{hide_table_of_contents:!0},sidebar:"myAutogeneratedSidebar",previous:{title:"LP as Collateral in a Money Market",permalink:"/Developers/Oracles/LPAsCollateral"},next:{title:"Sanity checks for PT Integrations",permalink:"/Developers/Oracles/PTSanityChecks"}},s={},c=[{value:"Main Use Cases",id:"main-use-cases",level:2},{value:"1. Get leveraged APY doing yield arbitrage",id:"1-get-leveraged-apy-doing-yield-arbitrage",level:4},{value:"2. Leverage short yield",id:"2-leverage-short-yield",level:4},{value:"3. Leverage long assets while earning fixed yield",id:"3-leverage-long-assets-while-earning-fixed-yield",level:4},{value:"Risk analysis for PT as a collateral",id:"risk-analysis-for-pt-as-a-collateral",level:2},{value:"1. Smart contract vulnerability in Pendle contracts:",id:"1-smart-contract-vulnerability-in-pendle-contracts",level:3},{value:"2. Smart contract vulnerability in underlying protocols:",id:"2-smart-contract-vulnerability-in-underlying-protocols",level:3},{value:"3. Oracle exploit:",id:"3-oracle-exploit",level:3},{value:"4. Insufficient PT liquidity for liquidation in a short duration",id:"4-insufficient-pt-liquidity-for-liquidation-in-a-short-duration",level:3},{value:"Assessment - Study 1: we want to make sure if PT/borrowAsset price drops siginificantly in one go, liquidators can liquidate the maximum possible liquidatable PT collaterals in profit",id:"assessment---study-1-we-want-to-make-sure-if-ptborrowasset-price-drops-siginificantly-in-one-go-liquidators-can-liquidate-the-maximum-possible-liquidatable-pt-collaterals-in-profit",level:4},{value:"Assessment - On collateral factor for PT",id:"assessment---on-collateral-factor-for-pt",level:4},{value:"5. Highly volatile PT price could liquidate users unnessarily",id:"5-highly-volatile-pt-price-could-liquidate-users-unnessarily",level:3}],u={toc:c},d="wrapper";function p(e){let{components:t,...a}=e;return(0,l.kt)(d,(0,i.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"pt-as-collateral-in-a-money-market"},"PT as Collateral in a Money Market"),(0,l.kt)("p",null,"PTs are good collaterals in a money market since it is a fixed rate position (or a zero coupon bond) on an asset. This document discusses the use cases for PT as a collateral, as well as considerations for a money market when integrating PT as a collateral."),(0,l.kt)("h2",{id:"main-use-cases"},"Main Use Cases"),(0,l.kt)("h4",{id:"1-get-leveraged-apy-doing-yield-arbitrage"},"1. Get leveraged APY doing yield arbitrage"),(0,l.kt)("p",null,"Example: PT-stETH gives a fixed 5% APY, but the ETH borrow rate is only 3% in the money market."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"In this case, a user can deposit PT-stETH as collateral, borrow ETH, swap borrowed ETH to more PT-stETH to use as more collateral, and so on."),(0,l.kt)("li",{parentName:"ul"},"As a result, the user will get a leveraged APY in ETH terms, benefiting from the difference between the PT fixed rate and ETH borrow rate"),(0,l.kt)("li",{parentName:"ul"},"If the collateral factor is 0.80, the user can leverage 5x their capital to get a maximum APY of 5 * (5-3) = 10%")),(0,l.kt)("p",null,"This use case is similar to depositing a yield bearing asset (like wstETH) and borrowing (ETH) in a money market, but is better due to the certainty from the fixed rate in PT."),(0,l.kt)("h4",{id:"2-leverage-short-yield"},"2. Leverage short yield"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"If a user thinks the current fixed yield in Pendle is overvalued (PT is undervalued), they can do the exact step as the previous section (for example, use PT-stETH as collateral to borrow ETH to buy more PT-stETH) to short yield."),(0,l.kt)("li",{parentName:"ul"},"If the fixed yield indeed goes down, the user can unwind their position (sell PT to repay the borrowed ETH) for a profit.")),(0,l.kt)("h4",{id:"3-leverage-long-assets-while-earning-fixed-yield"},"3. Leverage long assets while earning fixed yield"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"If a user is bullish on an asset in the long term, they can use its PT as a collateral to borrow stables to buy more PT"),(0,l.kt)("li",{parentName:"ul"},"For example, a long term ETH holder can use PT-stETH as collateral to borrow USDC to buy more PT-stETH"),(0,l.kt)("li",{parentName:"ul"},"Essentially, the user will be getting a fixed APY (from PT) on top of their leveraged long position on ETH.")),(0,l.kt)("h2",{id:"risk-analysis-for-pt-as-a-collateral"},"Risk analysis for PT as a collateral"),(0,l.kt)("h3",{id:"1-smart-contract-vulnerability-in-pendle-contracts"},"1. Smart contract vulnerability in Pendle contracts:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"If Pendle contracts malfunctions or gets exploited, PT could lose value significantly in a short duration, leading to bad debt for the money market protocol."),(0,l.kt)("li",{parentName:"ul"},"Assessment:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Pendle V2 contracts have been audited by 6 auditors, with 3 of the top 4 C4 auditors. Find the audit reports ",(0,l.kt)("a",{parentName:"li",href:"https://github.com/pendle-finance/pendle-core-v2-public/tree/main/audits"},"here"),"."),(0,l.kt)("li",{parentName:"ul"},"Pendle V2 contract system's components (SY, YT-PT, Market, vePENDLE) are decoupled from each other, only interacting with the other components via interfaces, decreasing the chance for bugs due to complexity and interwoven logic."),(0,l.kt)("li",{parentName:"ul"},"Lindy-ness: There have been no incidents so far in Pendle contracts since June 2021",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Pendle V2 contracts have been live since November 2022 (peak TVL of $93M)"),(0,l.kt)("li",{parentName:"ul"},"Pendle V1 contracts (with many similar mechanisms to V2) have been live since June 2021, with a peak TVL of $37M"))),(0,l.kt)("li",{parentName:"ul"},"Apart from the core Pendle contracts (for YT-PT and Pendle Market) which remain the same throughout, risk assessment needs to be done on the SY implementation for the particular PT pool.")))),(0,l.kt)("h3",{id:"2-smart-contract-vulnerability-in-underlying-protocols"},"2. Smart contract vulnerability in underlying protocols:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Each PT is built on top of an underlying yield bearing token (like stETH, USDT staked in Stargate). If the underlying protocol malfunctions or gets exploited, PT could lose value significantly in a short duration, leading to bad debt for the money market"),(0,l.kt)("li",{parentName:"ul"},"As such, risk assessment should be made for each underlying protocol for each PT.")),(0,l.kt)("h3",{id:"3-oracle-exploit"},"3. Oracle exploit:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"If the oracle for PT price is easily manipulated or exploited, PT price could inflate unnaturally (leading to an attack of using over-priced PT to borrow, and get away with free money leading to bad protocol debt after PT price drops sharply after), or drops sharply (leading to bad debt for the protocol)"),(0,l.kt)("li",{parentName:"ul"},"Assessment:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Pendle's oracle for PT/asset is permissionless and built into the contract (no maintanance needed), hence liveness and correctness is not a concern."),(0,l.kt)("li",{parentName:"ul"},"The PT/asset oracle can return TWAP prices for customisable durations (within 65536 blocks, which is ~9 days for Ethereum), hence is not susceptible to short term or within-a-block manipulation of prices if the TWAP duration used is sufficient.")))),(0,l.kt)("h3",{id:"4-insufficient-pt-liquidity-for-liquidation-in-a-short-duration"},"4. Insufficient PT liquidity for liquidation in a short duration"),(0,l.kt)("p",null,"When PT price drops significantly vs the borrowAsset (say for 20%) and doesn't bounce back, there might not be enough liquidity to liquidate PT collaterals for liquidatable loans, which might lead to bad debt."),(0,l.kt)("h4",{id:"assessment---study-1-we-want-to-make-sure-if-ptborrowasset-price-drops-siginificantly-in-one-go-liquidators-can-liquidate-the-maximum-possible-liquidatable-pt-collaterals-in-profit"},"Assessment - Study 1: we want to make sure if PT/borrowAsset price drops siginificantly in one go, liquidators can liquidate the maximum possible liquidatable PT collaterals in profit"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Assume the following parameters in the money market:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Collateral factor for PT: ",(0,l.kt)("inlineCode",{parentName:"li"},"cRatio")),(0,l.kt)("li",{parentName:"ul"},"Deposit limit for PT collateral: ",(0,l.kt)("inlineCode",{parentName:"li"},"dCap")," (in dollars)"),(0,l.kt)("li",{parentName:"ul"},"Let's say after a significant price drop, the maximum portion of loans (using PT collaterals) that will become liquidatable will be ",(0,l.kt)("inlineCode",{parentName:"li"},"k")," (",(0,l.kt)("inlineCode",{parentName:"li"},"k")," = 0.3 might be a reasonable number. 30% of the borrow becomes liquidate-able in one single moment)"),(0,l.kt)("li",{parentName:"ul"},"When a position becomes liquidatable, liquidators can liquidate a portion ",(0,l.kt)("inlineCode",{parentName:"li"},"f")," of the liquidatable position (usually 50% in most money markets)"),(0,l.kt)("li",{parentName:"ul"},"The profit for liquidators is ",(0,l.kt)("inlineCode",{parentName:"li"},"p")," (usually ~5-10% in money markets)"))),(0,l.kt)("li",{parentName:"ul"},"When PT/borrowAsset price drops significantly, we will need to liquidate a maximum of ",(0,l.kt)("inlineCode",{parentName:"li"},"dCap * cRatio * k")," worth of borrow. The maximum amount liquidators can repay and liquidate is ",(0,l.kt)("inlineCode",{parentName:"li"},"dCap * cRatio * k * f"),". The collateral dollar value that liquidators will get (and need to sell) is ",(0,l.kt)("inlineCode",{parentName:"li"},"dCap * cRatio * k * f * (1+p)")),(0,l.kt)("li",{parentName:"ul"},"To make a profitable liquidation, we need to be able to sell these PT collaterals for < ",(0,l.kt)("inlineCode",{parentName:"li"},"p")," price impact (since the profit is ",(0,l.kt)("inlineCode",{parentName:"li"},"p"),")"),(0,l.kt)("li",{parentName:"ul"},"To sell PT collaterals to borrowAsset, we need to sell PT to SY (a yield bearing position of PT's asset) via Pendle's market, convert SY to asset and sell asset for borrowAsset"),(0,l.kt)("li",{parentName:"ul"},"Assuming minimal price impact for selling asset to borrowAsset (might not hold for non-bluechip borrow asset), ",(0,l.kt)("strong",{parentName:"li"},"we just need to make sure that we could sell ",(0,l.kt)("inlineCode",{parentName:"strong"},"dCap * cRatio * k * f * (1+p)")," worth of PT with less than ",(0,l.kt)("inlineCode",{parentName:"strong"},"p")," price impact.")),(0,l.kt)("li",{parentName:"ul"},"Example for listing PT-stETH-Dec2025 in CompoundV2 with a collateral factor ",(0,l.kt)("inlineCode",{parentName:"li"},"cRatio")," of 0.70",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"cRatio = 0.70")),(0,l.kt)("li",{parentName:"ul"},"Assume ",(0,l.kt)("inlineCode",{parentName:"li"},"k = 0.30")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"f = 0.5")," in Compound"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"p = 0.08")," in Compound"),(0,l.kt)("li",{parentName:"ul"},"Hence, selling ",(0,l.kt)("inlineCode",{parentName:"li"},"dCap * 0.70 * 0.30 * 0.5 * (1+0.08) = 0.1134 dCap")," worth of PT should have a price impact of lower than 8%"),(0,l.kt)("li",{parentName:"ul"},"As of writing (2 Jun 2023), selling $1M of PT-stETH-Dec2025 has a price impact of 2.5%"),(0,l.kt)("li",{parentName:"ul"},"Therefore, a ",(0,l.kt)("inlineCode",{parentName:"li"},"dCap")," of $1M / 0.1134 = $8.8M is already pretty safe (since it will be corresponding to a sell of $1M of PT, which only has a 2.5% price impact, well less than 8%)"))),(0,l.kt)("li",{parentName:"ul"},"This could be used as a framework to gauge how reasonable certain numbers for ",(0,l.kt)("inlineCode",{parentName:"li"},"dCap"),", ",(0,l.kt)("inlineCode",{parentName:"li"},"cRatio")," could be for certain PT collateral."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Important note"),": There is a cascading effect, where PT price dropping due to the collateral sell could lead to more liquidation. Ideally, the factor ",(0,l.kt)("inlineCode",{parentName:"li"},"k")," should already take this into account (basically, after all the cascading effect from PT price dropping due to liquidations, what's the proportion of PT-collateralised loans that will become liquidatable). In the most extreme assumption, we could assume ",(0,l.kt)("inlineCode",{parentName:"li"},"k=1")," for the strictest analysis.")),(0,l.kt)("h4",{id:"assessment---on-collateral-factor-for-pt"},"Assessment - On collateral factor for PT"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Study 1 is already the strictest analysis, where all the liquidatble PT collaterals can be liquidated in one go."),(0,l.kt)("li",{parentName:"ul"},"Due to the nature of Pendle AMM which is specialised for trading PTs (it concentrates liquidity, taking into account how PT will converge to the underlying asset), price impact for selling an amount of PT is much smaller than a normal pool of the same liquidity can provide."),(0,l.kt)("li",{parentName:"ul"},"When setting collateral factor for PT, the bottom line is to protect the money market from bad debt, in case PT/borrowAsset price drops so fast that liquidations can't happen fast enough to liquidate the liquidatable accounts."),(0,l.kt)("li",{parentName:"ul"},'In terms of "being able to liquidate PTs fast enough", there are two factors:',(0,l.kt)("ol",{parentName:"li"},(0,l.kt)("li",{parentName:"ol"},"Liquidity for liquidating PTs, to support liquidating PTs in a short duration."),(0,l.kt)("li",{parentName:"ol"},"The liquidation system which needs to be functional and reacts fast enough to liquidate in time"))),(0,l.kt)("li",{parentName:"ul"},"For i: it's already covered in Study 1, so theoretically if the equation (taking into account the important note) in Study 1 holds, it's good (even if cRatio is 0.90). This is assuming a highly efficient liquidation system that could liquidate immediately."),(0,l.kt)("li",{parentName:"ul"},"For ii: it depends on how mature and decentralised the liquidation ecosystem for the money market is. If the liquidators are highly active/efficient, collateral factors could be set higher"),(0,l.kt)("li",{parentName:"ul"},"In another approach for thinking about setting collateral factor for PT: it could be similar to the collateral factor for PT's asset in the money market, since PT price will fluctuate along the asset's price."),(0,l.kt)("li",{parentName:"ul"},"Since it's generally troublesome to decrease collateral factor and much easier to increase it, it's generally a good approach to start with more conservative collateral factors")),(0,l.kt)("h3",{id:"5-highly-volatile-pt-price-could-liquidate-users-unnessarily"},"5. Highly volatile PT price could liquidate users unnessarily"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"If PT prices are too volatile, a temporary dip in PT price could liquidate certain users unnessarily"),(0,l.kt)("li",{parentName:"ul"},"Assessment:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"In normal circumstances, PT price in terms of asset should not fluctuate as wildly as normal asset prices since it's based on people trading interest rates (which don't change too often)."),(0,l.kt)("li",{parentName:"ul"},"Depending on the nature of the PT collateral (nature of the interest rate, and liquidity of the pool), an appropriate TWAP duration could be used in the oracle, to minimise liquidations due to temporary dips in PT prices.")))))}p.isMDXComponent=!0}}]);