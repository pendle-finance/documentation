"use strict";(self.webpackChunkpendle_documentation=self.webpackChunkpendle_documentation||[]).push([[1026],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>d});var r=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},s=Object.keys(e);for(r=0;r<s.length;r++)a=s[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)a=s[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var l=r.createContext({}),p=function(e){var t=r.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},k=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,s=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),m=p(a),k=n,d=m["".concat(l,".").concat(k)]||m[k]||u[k]||s;return a?r.createElement(d,i(i({ref:t},c),{},{components:a})):r.createElement(d,i({ref:t},c))}));function d(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var s=a.length,i=new Array(s);i[0]=k;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[m]="string"==typeof e?e:n,i[1]=o;for(var p=2;p<s;p++)i[p]=a[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,a)}k.displayName="MDXCreateElement"},6449:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>s,metadata:()=>o,toc:()=>p});var r=a(7462),n=(a(7294),a(3905));const s={hide_table_of_contents:!0},i="High Level Architecture",o={unversionedId:"Boros/HighLevelArchitecture",id:"Boros/HighLevelArchitecture",title:"High Level Architecture",description:"Core Contracts",source:"@site/docs/Boros/HighLevelArchitecture.md",sourceDirName:"Boros",slug:"/Boros/HighLevelArchitecture",permalink:"/Boros/HighLevelArchitecture",draft:!1,tags:[],version:"current",frontMatter:{hide_table_of_contents:!0}},l={},p=[{value:"Core Contracts",id:"core-contracts",level:2},{value:"Router",id:"router",level:3},{value:"MarketHub",id:"markethub",level:3},{value:"Market",id:"market",level:3},{value:"AMM",id:"amm",level:3},{value:"Token Decimals",id:"token-decimals",level:2}],c={toc:p},m="wrapper";function u(e){let{components:t,...a}=e;return(0,n.kt)(m,(0,r.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"high-level-architecture"},"High Level Architecture"),(0,n.kt)("h2",{id:"core-contracts"},"Core Contracts"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-mermaid"},"graph TD\n    Router --\x3e MarketHub\n    MarketHub --\x3e Market-1\n    MarketHub --\x3e Market-2\n    MarketHub --\x3e Market-3\n    MarketHub --\x3e ...\n    MarketHub --\x3e Market-n\n")),(0,n.kt)("p",null,"Router authenticates and forwards user operations to MarketHub."),(0,n.kt)("p",null,"MarketHub receives user operations from Router, forward to the correct market contract, settle fees/payment, and check that accounts fulfill the margin requirements."),(0,n.kt)("p",null,"Market executes user operations from MarketHub, then returns payment amount and data for margin checking."),(0,n.kt)("h3",{id:"router"},"Router"),(0,n.kt)("p",null,"Router is the gateway to the Boros protocol. Its main functionality is authentication and authorization. Transactions can be sent to Router in two ways:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Direct call where ",(0,n.kt)("inlineCode",{parentName:"li"},"msg.sender")," is used as user address"),(0,n.kt)("li",{parentName:"ul"},"Agent call where user signs messages of desired operations",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Only available to Pendle's permissioned relayers"),(0,n.kt)("li",{parentName:"ul"},"Accessed through ",(0,n.kt)("a",{parentName:"li",href:"/Boros/Backend/SDK"},"Boros SDK"))))),(0,n.kt)("h3",{id:"markethub"},"MarketHub"),(0,n.kt)("p",null,"MarketHub is the market coordinator and risk manager of Boros. MarketHub holds user deposits and keeps track of users in the system and the markets that they have entered. Users are identified by MarketAcc, a custom type made of:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"user EVM address"),(0,n.kt)("li",{parentName:"ul"},"subaccountID",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Every user has up to 256 subaccounts, though only subaccount 0 is available to direct call"))),(0,n.kt)("li",{parentName:"ul"},"tokenId",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Every collateral token has a specific ID inside Boros. A given MarketAcc can only interact with markets of that collateral token."))),(0,n.kt)("li",{parentName:"ul"},"marketId",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"For isolated-margin account, this is the marketId of the market that this accounts operates on."),(0,n.kt)("li",{parentName:"ul"},"For cross-margin account, this is a special value ",(0,n.kt)("em",{parentName:"li"},"CROSS"),", equal to ",(0,n.kt)("span",{parentName:"li",className:"math math-inline"},(0,n.kt)("span",{parentName:"span",className:"katex"},(0,n.kt)("span",{parentName:"span",className:"katex-mathml"},(0,n.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,n.kt)("semantics",{parentName:"math"},(0,n.kt)("mrow",{parentName:"semantics"},(0,n.kt)("msup",{parentName:"mrow"},(0,n.kt)("mn",{parentName:"msup"},"2"),(0,n.kt)("mn",{parentName:"msup"},"24")),(0,n.kt)("mo",{parentName:"mrow"},"\u2212"),(0,n.kt)("mn",{parentName:"mrow"},"1")),(0,n.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"2^{24}-1")))),(0,n.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,n.kt)("span",{parentName:"span",className:"base"},(0,n.kt)("span",{parentName:"span",className:"strut",style:{height:"0.897438em",verticalAlign:"-0.08333em"}}),(0,n.kt)("span",{parentName:"span",className:"mord"},(0,n.kt)("span",{parentName:"span",className:"mord"},"2"),(0,n.kt)("span",{parentName:"span",className:"msupsub"},(0,n.kt)("span",{parentName:"span",className:"vlist-t"},(0,n.kt)("span",{parentName:"span",className:"vlist-r"},(0,n.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.8141079999999999em"}},(0,n.kt)("span",{parentName:"span",style:{top:"-3.063em",marginRight:"0.05em"}},(0,n.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,n.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,n.kt)("span",{parentName:"span",className:"mord mtight"},(0,n.kt)("span",{parentName:"span",className:"mord mtight"},"2"),(0,n.kt)("span",{parentName:"span",className:"mord mtight"},"4"))))))))),(0,n.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}}),(0,n.kt)("span",{parentName:"span",className:"mbin"},"\u2212"),(0,n.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}})),(0,n.kt)("span",{parentName:"span",className:"base"},(0,n.kt)("span",{parentName:"span",className:"strut",style:{height:"0.64444em",verticalAlign:"0em"}}),(0,n.kt)("span",{parentName:"span",className:"mord"},"1"))))),".")))),(0,n.kt)("p",null,"An account can enter a single market, if it is isolated, or multiple markets, if it is ",(0,n.kt)("em",{parentName:"p"},"CROSS"),". Every market represents a different interest rate swap type: different token, different maturity, different reference rate. However, every market entered by a given account must share the same collateral token."),(0,n.kt)("p",null,"After each user operation, MarketHub checks that accounts fulfill the ",(0,n.kt)("a",{parentName:"p",href:"/Boros/Mechanics/Margin"},"margin requirements"),"."),(0,n.kt)("h3",{id:"market"},"Market"),(0,n.kt)("p",null,"Boros markets is deployed as separate contracts. Markets are differentiated by their descriptors:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"- bool isIsolatedOnly\n- TokenId tokenId\n- MarketId marketId\n- uint32 maturity\n- uint8 tickStep\n- uint16 iTickThresh\n- uint32 latestFTime\n")),(0,n.kt)("p",null,"Market provides an on-chain ",(0,n.kt)("a",{parentName:"p",href:"/Boros/Mechanics/OrderBook"},"central limit order book"),", as well as over-the-counter (OTC) trading. For each user, market keeps track of position size and list of orders. When an order is filled, or an OTC trade is made, the position size is updated accordingly, and the fixed interest is paid upfront. Variable interest payments are paid on a fixed time period; the payment amount is determined by the accrual of the variable interest since last update, which is reported on-chain via an oracle."),(0,n.kt)("h3",{id:"amm"},"AMM"),(0,n.kt)("p",null,"Automated Market Makers (AMM) provide continuous liquidity alongside the order book. In Boros, AMMs are like normal accounts: they don't have any special permissions except that they can perform OTC trades with users when requested. Router ensures optimal liquidity routing between AMMs and order book for best swap rate."),(0,n.kt)("p",null,"More details about AMM can be found in the ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/pendle-finance/boros-core-public/blob/main/whitepapers/AMM.pdf"},"whitepaper"),"."),(0,n.kt)("h2",{id:"token-decimals"},"Token Decimals"),(0,n.kt)("p",null,"Internally, Boros uses 18-decimals fixed point for all numerical values, including position size, payment, fees, etc."),(0,n.kt)("p",null,"When depositing ERC20 tokens of non-18 decimals, the amount will be scaled up. Similarly, when withdrawing, the amount will be scaled down."),(0,n.kt)("p",null,"Tokens with decimal greater than 18 are not supported."))}u.isMDXComponent=!0}}]);