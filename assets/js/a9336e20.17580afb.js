"use strict";(self.webpackChunkpendle_documentation=self.webpackChunkpendle_documentation||[]).push([[6354],{3447:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"Developers/HighLevelArchitecture","title":"High Level Architecture","description":"High Level Architecture","source":"@site/docs/pendle-v2/Developers/HighLevelArchitecture.md","sourceDirName":"Developers","slug":"/Developers/HighLevelArchitecture","permalink":"/pendle-v2/Developers/HighLevelArchitecture","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"hide_table_of_contents":true},"sidebar":"myAutogeneratedSidebar","previous":{"title":"Overview","permalink":"/pendle-v2/Developers/Overview"},"next":{"title":"Frequently Asked Questions","permalink":"/pendle-v2/Developers/FAQ"}}');var r=n(4848),s=n(8453);const l={hide_table_of_contents:!0},d="High Level Architecture",a={},c=[{value:"Functions of Contracts",id:"functions-of-contracts",level:2},{value:"PendleRouter",id:"pendlerouter",level:3},{value:"Standardized Yield (SY)",id:"standardized-yield-sy",level:3},{value:"Principal Token (PT)",id:"principal-token-pt",level:3},{value:"Yield Token (YT)",id:"yield-token-yt",level:3},{value:"PendleMarket",id:"pendlemarket",level:3},{value:"Contract Factories",id:"contract-factories",level:2},{value:"Factory Versions",id:"factory-versions",level:3},{value:"Immutability vs. Upgradability",id:"immutability-vs-upgradability",level:3},{value:"Cross-Chain Principal Tokens",id:"cross-chain-principal-tokens",level:2}];function o(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"high-level-architecture",children:"High Level Architecture"})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"High Level Architecture",src:n(9394).A+"",title:"High Level Architecture",width:"2250",height:"1376"})}),"\n",(0,r.jsx)(t.h2,{id:"functions-of-contracts",children:"Functions of Contracts"}),"\n",(0,r.jsx)(t.h3,{id:"pendlerouter",children:"PendleRouter"}),"\n",(0,r.jsx)(t.p,{children:"PendleRouter is a contract that aggregates callers' actions with various different SYs, PTs, YTs, and Markets. It does not have any special permissions or whitelists on any contracts it interacts with. Therefore, any third-party protocols can freely embed the router's logic into their code for better gas efficiency."}),"\n",(0,r.jsxs)(t.p,{children:["You can read more about the PendleRouter ",(0,r.jsx)(t.a,{href:"/pendle-v2/Developers/Contracts/PendleRouter/PendleRouterOverview",children:"here"}),"."]}),"\n",(0,r.jsx)(t.h3,{id:"standardized-yield-sy",children:"Standardized Yield (SY)"}),"\n",(0,r.jsx)(t.p,{children:"SY is a wrapped version of the interest-bearing token (ibToken) that can also be staked into other protocols to earn even more interest. In the Pendle system, SY is used instead of the ibToken for all operations, including trading on PendleMarket or minting Principal Token & Yield Token."}),"\n",(0,r.jsx)(t.p,{children:"The following are true:"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{style:{textAlign:"center"},children:"SY"}),(0,r.jsx)(t.th,{style:{textAlign:"center"},children:"ibToken (1 SY = 1 ib Token)"}),(0,r.jsx)(t.th,{style:{textAlign:"center"},children:"Asset (ibToken appreciates against)"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"SY GLP"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:(0,r.jsx)(t.code,{children:"GLP"})}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"NIL, GLP doesn't appreciate"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"SY wstETH"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:(0,r.jsx)(t.code,{children:"wstETH"})}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"stETH"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"SY ETHx"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:(0,r.jsx)(t.code,{children:"ETHx"})}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"ETH locked in ETHx contract*"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"SY aUSDC"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"Not 1-1 to aUSDC since it's rebasing"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"aUSDC"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"SY rETH-WETH_BalancerLP Aura"}),(0,r.jsxs)(t.td,{style:{textAlign:"center"},children:[(0,r.jsx)(t.code,{children:"rETH-WETH LP"})," of Balancer staked into the corresponding Aura's gauge"]}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"Liquidity of rETH-WETH pool"})]})]})]}),"\n",(0,r.jsxs)(t.p,{children:["For ",(0,r.jsx)(t.code,{children:"*"}),": ETH locked in ETHx is different from normal ETH due to withdrawal from ETHx has delay. Under normal circumstances it's also normal for ETHx to trade at a market price lower than the amount of ETH it can be withdrawn to."]}),"\n",(0,r.jsx)(t.h3,{id:"principal-token-pt",children:"Principal Token (PT)"}),"\n",(0,r.jsxs)(t.p,{children:["PT is a token that represents the right to redeem for the principal amount at maturity, and is tradable on PendleMarket. While PT represents a claim to a fixed amount of assets, SY wraps an ibToken that increases in value, meaning that ",(0,r.jsx)(t.code,{children:"1 PT != 1 SY"})," is usually true (except in exceptional cases). Instead, ",(0,r.jsx)(t.code,{children:"1 PT = 1 Asset"}),', where "Asset" refers to what SY\'s ibToken is denominated in.']}),"\n",(0,r.jsx)(t.p,{children:"The following are true:"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{style:{textAlign:"center"},children:"PT"}),(0,r.jsx)(t.th,{style:{textAlign:"center"},children:"Asset (1 PT = 1 Asset)"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"PT GLP"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"GLP"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"PT wstETH"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"stETH"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"PT ETHx"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"ETH locked in ETHx contract"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"PT aUSDC"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"aUSDC"})]})]})]}),"\n",(0,r.jsxs)(t.p,{children:["At redemption, ",(0,r.jsx)(t.code,{children:"1 PT = X SY"}),", where ",(0,r.jsx)(t.code,{children:"X"})," satisfies the condition that ",(0,r.jsx)(t.code,{children:"X SY = 1 Asset"}),". For example, assuming ",(0,r.jsx)(t.code,{children:"1 wstETH = 1.2 stETH"})," on 1/1/2024, ",(0,r.jsx)(t.code,{children:"1 PT-wstETH-01JAN2024"})," will be redeemable to ",(0,r.jsx)(t.code,{children:"0.8928 wstETH"})," at maturity."]}),"\n",(0,r.jsx)(t.h3,{id:"yield-token-yt",children:"Yield Token (YT)"}),"\n",(0,r.jsx)(t.p,{children:"YT is a token that represents the rights to redeem the interest generated by the SY until it reaches maturity. It's important to note that the value of YT is zero once it reaches maturity. The yield can be redeemed at any time and it can be traded on PendleMarket using special methods. ibToken generates yield in two forms, which Pendle denotes as:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Interest"})," (compounding yield): The yield is denominated in the same unit as the asset of ibToken. For example, as time goes on, ",(0,r.jsx)(t.code,{children:"wstETH"})," becomes worth more in terms of ",(0,r.jsx)(t.code,{children:"stETH"}),", and ",(0,r.jsx)(t.code,{children:"SY-aUSDC"})," becomes worth more in terms of ",(0,r.jsx)(t.code,{children:"USDC"}),"."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Rewards"})," (yield that does not compound): The yield is given out in a different unit than the ibToken. For example, GLP generates ETH."]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"The following are true:"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{style:{textAlign:"center"},children:"YT"}),(0,r.jsx)(t.th,{style:{textAlign:"center"},children:"Interest"}),(0,r.jsx)(t.th,{style:{textAlign:"center"},children:"Rewards"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"YT GLP"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"-"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"ETH"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"YT wstETH"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"stETH"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"-"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"YT ETHx"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"ETH locked in ETHx contract"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"-"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"YT aUSDC"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"aUSDC"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"-"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"YT rETH-WETH_BalancerLP Aura"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"liquidity of rETH-WETH pool"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"AURA, BAL"})]})]})]}),"\n",(0,r.jsxs)(t.p,{children:["PT and YT are minted and redeemed using the YT contract. To mint PT and YT, SY is utilized. ",(0,r.jsx)(t.code,{children:"1 SY = X PT + X YT"})," is created where ",(0,r.jsx)(t.code,{children:"1 SY = X Asset"}),". Prior to maturity, both PT and YT must be provided to redeem the underlying SY. After maturity, only PT is required for redemption."]}),"\n",(0,r.jsx)(t.h3,{id:"pendlemarket",children:"PendleMarket"}),"\n",(0,r.jsx)(t.p,{children:"PendleMarket (or simply Market) is a contract that enables users to trade between PT and its corresponding SY, while still allowing liquidity provision as usual. Swap fees are directly compounded into the LP. Each Market also has its own built-in geometric-mean oracle, similar to UniswapV3."}),"\n",(0,r.jsx)(t.p,{children:"Currently, there is no market to trade YT, but it is always tradable by the following algorithms:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"SY \u279d YT"})," = flashswap SY, mint PT & YT, payback PT, send YT to users."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"YT \u279d SY"})," = flashswap PT, use PT & YT, redeem SY, pay back, send excess to users."]}),"\n"]}),"\n",(0,r.jsx)(t.admonition,{title:"YT Fungibility",type:"info",children:(0,r.jsxs)(t.p,{children:["All Yield Tokens (YT) of the same underlying asset are ",(0,r.jsx)(t.strong,{children:"completely fungible"}),". It is not programmatically possible to distinguish between YT acquired through minting, swapping, or LPing. User balances are queried on the SY contract, which treats all YT of a given type as identical. Any attempt to classify users or distribute rewards based on how they acquired their YT is not feasible on-chain."]})}),"\n",(0,r.jsx)(t.h2,{id:"contract-factories",children:"Contract Factories"}),"\n",(0,r.jsx)(t.p,{children:"Pendle uses a factory pattern for deploying new markets, PTs, and YTs. This standardizes the creation process and provides a single source of truth for identifying valid protocol components."}),"\n",(0,r.jsx)(t.h3,{id:"factory-versions",children:"Factory Versions"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Version"}),(0,r.jsx)(t.th,{children:"Timeframe"}),(0,r.jsx)(t.th,{children:"Key Changes"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Pre-V3"}),(0,r.jsx)(t.td,{children:"Early deployments"}),(0,r.jsx)(t.td,{children:"Initial factory implementations"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"V3"})}),(0,r.jsx)(t.td,{children:"Late 2023"}),(0,r.jsx)(t.td,{children:"Standard for all new deployments across all chains"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"V4/V5"})}),(0,r.jsx)(t.td,{children:"Mid-2024"}),(0,r.jsxs)(t.td,{children:[(0,r.jsxs)(t.strong,{children:["Removed ",(0,r.jsx)(t.code,{children:"Permit"})," (EIP-2612) from all new PT, YT, and LP tokens"]})," to mitigate phishing attacks"]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"V6"})}),(0,r.jsx)(t.td,{children:"Late 2025"}),(0,r.jsx)(t.td,{children:"Current recommended version for all new market deployments"})]})]})]}),"\n",(0,r.jsx)(t.admonition,{title:"Security Note: Permit Removal",type:"caution",children:(0,r.jsxs)(t.p,{children:["Starting with V4/V5 factories, the ",(0,r.jsx)(t.code,{children:"Permit"})," function (EIP-2612) was ",(0,r.jsx)(t.strong,{children:"completely removed"})," from all newly created PT, YT, and LP tokens. The ",(0,r.jsx)(t.code,{children:"Permit"})," function, which allows gasless approvals via off-chain signatures, was identified as a significant phishing attack vector. Tokens created by V4+ factories no longer support ",(0,r.jsx)(t.code,{children:"permit()"}),"."]})}),"\n",(0,r.jsx)(t.admonition,{type:"warning",children:(0,r.jsxs)(t.p,{children:["Always use the ",(0,r.jsx)(t.strong,{children:"latest factory version"})," for new market deployments. Using deprecated factories can lead to issues including improper contract verification."]})}),"\n",(0,r.jsx)(t.h3,{id:"immutability-vs-upgradability",children:"Immutability vs. Upgradability"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Market contracts are immutable"}),' once deployed. Their fundamental parameters (including the concentrated yield range) cannot be changed. If a pool goes "out of range," a brand new market must be deployed and LPs must manually migrate.']}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"SY contracts are upgradable proxies"})," (for newer deployments). This allows adding support for new deposit assets or adjusting mechanisms without requiring a full market migration. When developing an SY externally, it is recommended to deploy it as an upgradeable contract using Pendle's proxy admin and transfer ownership to Pendle's pause controller."]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"cross-chain-principal-tokens",children:"Cross-Chain Principal Tokens"}),"\n",(0,r.jsx)(t.p,{children:"Cross-chain PTs allow Principal Tokens to be bridged and used on networks where Pendle may not have a full deployment, while concentrating deep trading liquidity on mainnet."}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Standard:"})," Uses ",(0,r.jsx)(t.a,{href:"https://docs.layerzero.network/v2/home/token-standards/oft-standard",children:"LayerZero's Omnichain Fungible Token (OFT)"})," standard."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Mechanism:"}),' Users can "zap in" to a PT position on a mainnet pool, then bridge the PT to a destination chain (e.g., Avalanche, HyperEVM) for use as collateral in local money markets.']}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Liquidation:"})," The system handles liquidations without relying on DEX liquidity on the destination chain \u2014 the underlying asset is converted and bridged back from mainnet."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Initial Pilot:"})," sUSDe/USDe PTs, with the goal of collateral support on money markets like Morpho."]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>d});var i=n(6540);const r={},s=i.createContext(r);function l(e){const t=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(s.Provider,{value:t},e.children)}},9394:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/high_level_architecture-457bcdd55f399a2d90b8c7bd9e2b6a09.png"}}]);