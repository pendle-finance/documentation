"use strict";(self.webpackChunkpendle_documentation=self.webpackChunkpendle_documentation||[]).push([[7142],{4075:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>l,default:()=>m,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"Mechanics/OrderBook","title":"Central Limit Order Book","description":"Boros implements a gas-optimized central limit order book (CLOB) specifically designed for the EVM. The order book architecture minimizes gas costs through lazy settlement and efficient data structures while maintaining the functionality expected from professional trading platforms.","source":"@site/docs/boros-dev-docs/Mechanics/OrderBook.mdx","sourceDirName":"Mechanics","slug":"/Mechanics/OrderBook","permalink":"/boros-dev/Mechanics/OrderBook","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"borosSidebar","previous":{"title":"\ud83c\udfd7\ufe0f High Level Architecture","permalink":"/boros-dev/HighLevelArchitecture"},"next":{"title":"\ud83d\udcb0 Margin","permalink":"/boros-dev/Mechanics/Margin"}}');var r=n(4848),t=n(8453);const a={},l="Central Limit Order Book",c={},d=[{value:"Order Book Structure",id:"order-book-structure",level:2},{value:"Tick to Rate Conversion",id:"tick-to-rate-conversion",level:2},{value:"Examples",id:"examples",level:3},{value:"Matching Priority",id:"matching-priority",level:2},{value:"Order Id",id:"order-id",level:2},{value:"Parsing OrderId",id:"parsing-orderid",level:3},{value:"Placing orders",id:"placing-orders",level:2},{value:"Time In Force",id:"time-in-force",level:3},{value:"Self-trade Prevention",id:"self-trade-prevention",level:3},{value:"Restrictions",id:"restrictions",level:3},{value:"TWAP Oracle",id:"twap-oracle",level:2}];function o(e){const s={a:"a",annotation:"annotation",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",math:"math",mn:"mn",mo:"mo",mrow:"mrow",mstyle:"mstyle",msup:"msup",mtable:"mtable",mtd:"mtd",mtext:"mtext",mtr:"mtr",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"central-limit-order-book",children:"Central Limit Order Book"})}),"\n",(0,r.jsxs)(s.p,{children:["Boros implements a gas-optimized central limit order book (CLOB) specifically designed for the EVM. The order book architecture minimizes gas costs through ",(0,r.jsx)(s.a,{href:"/boros-dev/Mechanics/Settlement",children:"lazy settlement"})," and efficient data structures while maintaining the functionality expected from professional trading platforms."]}),"\n",(0,r.jsx)(s.h2,{id:"order-book-structure",children:"Order Book Structure"}),"\n",(0,r.jsx)(s.p,{children:"The order book consists of two independent sides:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Long Side (Bids)"}),": Orders to buy/go long on interest rates"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Short Side (Asks)"}),": Orders to sell/go short on interest rates"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["Each side contains ",(0,r.jsx)(s.strong,{children:"65,536 discrete rate levels"})," (ticks) ranging from -32768 to 32767."]}),"\n",(0,r.jsx)(s.p,{children:"The tick system uses an exponential function to map discrete tick indices to interest rates. This design provides:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Compactness"}),": Entire rate range expressed with just 16 bits"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Expressiveness"}),": Finer granularity near zero, coarser at extremes"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Symmetry"}),": Equal precision for positive and negative rates"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["The tick spacing is configurable per market via the ",(0,r.jsx)(s.code,{children:"tickStep"})," parameter. A larger ",(0,r.jsx)(s.code,{children:"tickStep"})," creates wider rate intervals between ticks, suitable for more volatile markets."]}),"\n",(0,r.jsx)(s.h2,{id:"tick-to-rate-conversion",children:"Tick to Rate Conversion"}),"\n",(0,r.jsx)(s.p,{children:"The conversion between tick indices and interest rates follows an exponential formula:"}),"\n",(0,r.jsx)(s.span,{className:"katex-display",children:(0,r.jsxs)(s.span,{className:"katex",children:[(0,r.jsx)(s.span,{className:"katex-mathml",children:(0,r.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block",children:(0,r.jsxs)(s.semantics,{children:[(0,r.jsxs)(s.mrow,{children:[(0,r.jsx)(s.mtext,{children:"rate"}),(0,r.jsx)(s.mo,{stretchy:"false",children:"("}),(0,r.jsx)(s.mtext,{children:"tick"}),(0,r.jsx)(s.mo,{stretchy:"false",children:")"}),(0,r.jsx)(s.mo,{children:"="}),(0,r.jsxs)(s.mrow,{children:[(0,r.jsx)(s.mo,{fence:"true",children:"{"}),(0,r.jsxs)(s.mtable,{rowspacing:"0.36em",columnalign:"left left",columnspacing:"1em",children:[(0,r.jsxs)(s.mtr,{children:[(0,r.jsx)(s.mtd,{children:(0,r.jsx)(s.mstyle,{scriptlevel:"0",displaystyle:"false",children:(0,r.jsxs)(s.mrow,{children:[(0,r.jsxs)(s.msup,{children:[(0,r.jsx)(s.mn,{children:"1.00005"}),(0,r.jsxs)(s.mrow,{children:[(0,r.jsx)(s.mtext,{children:"tick"}),(0,r.jsx)(s.mo,{children:"\xd7"}),(0,r.jsx)(s.mtext,{children:"tickStep"})]})]}),(0,r.jsx)(s.mo,{children:"\u2212"}),(0,r.jsx)(s.mn,{children:"1"})]})})}),(0,r.jsx)(s.mtd,{children:(0,r.jsx)(s.mstyle,{scriptlevel:"0",displaystyle:"false",children:(0,r.jsxs)(s.mrow,{children:[(0,r.jsx)(s.mtext,{children:"if\xa0tick"}),(0,r.jsx)(s.mo,{children:"\u2265"}),(0,r.jsx)(s.mn,{children:"0"})]})})})]}),(0,r.jsxs)(s.mtr,{children:[(0,r.jsx)(s.mtd,{children:(0,r.jsx)(s.mstyle,{scriptlevel:"0",displaystyle:"false",children:(0,r.jsxs)(s.mrow,{children:[(0,r.jsx)(s.mo,{children:"\u2212"}),(0,r.jsx)(s.mo,{stretchy:"false",children:"("}),(0,r.jsxs)(s.msup,{children:[(0,r.jsx)(s.mn,{children:"1.00005"}),(0,r.jsxs)(s.mrow,{children:[(0,r.jsx)(s.mo,{children:"\u2212"}),(0,r.jsx)(s.mtext,{children:"tick"}),(0,r.jsx)(s.mo,{children:"\xd7"}),(0,r.jsx)(s.mtext,{children:"tickStep"})]})]}),(0,r.jsx)(s.mo,{children:"\u2212"}),(0,r.jsx)(s.mn,{children:"1"}),(0,r.jsx)(s.mo,{stretchy:"false",children:")"})]})})}),(0,r.jsx)(s.mtd,{children:(0,r.jsx)(s.mstyle,{scriptlevel:"0",displaystyle:"false",children:(0,r.jsxs)(s.mrow,{children:[(0,r.jsx)(s.mtext,{children:"if\xa0tick"}),(0,r.jsx)(s.mo,{children:"<"}),(0,r.jsx)(s.mn,{children:"0"})]})})})]})]})]})]}),(0,r.jsx)(s.annotation,{encoding:"application/x-tex",children:"\\text{rate}(\\text{tick}) = \\begin{cases}\n1.00005^{\\text{tick} \\times \\text{tickStep}} - 1 & \\text{if tick} \\geq 0 \\\\\n-(1.00005^{-\\text{tick} \\times \\text{tickStep}} - 1) & \\text{if tick} < 0\n\\end{cases}"})]})})}),(0,r.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,r.jsxs)(s.span,{className:"base",children:[(0,r.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,r.jsx)(s.span,{className:"mord text",children:(0,r.jsx)(s.span,{className:"mord",children:"rate"})}),(0,r.jsx)(s.span,{className:"mopen",children:"("}),(0,r.jsx)(s.span,{className:"mord text",children:(0,r.jsx)(s.span,{className:"mord",children:"tick"})}),(0,r.jsx)(s.span,{className:"mclose",children:")"}),(0,r.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,r.jsx)(s.span,{className:"mrel",children:"="}),(0,r.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,r.jsxs)(s.span,{className:"base",children:[(0,r.jsx)(s.span,{className:"strut",style:{height:"3em",verticalAlign:"-1.25em"}}),(0,r.jsxs)(s.span,{className:"minner",children:[(0,r.jsx)(s.span,{className:"mopen delimcenter",style:{top:"0em"},children:(0,r.jsx)(s.span,{className:"delimsizing size4",children:"{"})}),(0,r.jsx)(s.span,{className:"mord",children:(0,r.jsxs)(s.span,{className:"mtable",children:[(0,r.jsx)(s.span,{className:"col-align-l",children:(0,r.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,r.jsxs)(s.span,{className:"vlist-r",children:[(0,r.jsxs)(s.span,{className:"vlist",style:{height:"1.69em"},children:[(0,r.jsxs)(s.span,{style:{top:"-3.69em"},children:[(0,r.jsx)(s.span,{className:"pstrut",style:{height:"3.008em"}}),(0,r.jsxs)(s.span,{className:"mord",children:[(0,r.jsx)(s.span,{className:"mord",children:"1.0000"}),(0,r.jsxs)(s.span,{className:"mord",children:[(0,r.jsx)(s.span,{className:"mord",children:"5"}),(0,r.jsx)(s.span,{className:"msupsub",children:(0,r.jsx)(s.span,{className:"vlist-t",children:(0,r.jsx)(s.span,{className:"vlist-r",children:(0,r.jsx)(s.span,{className:"vlist",style:{height:"0.8491em"},children:(0,r.jsxs)(s.span,{style:{top:"-3.063em",marginRight:"0.05em"},children:[(0,r.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,r.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,r.jsxs)(s.span,{className:"mord mtight",children:[(0,r.jsx)(s.span,{className:"mord text mtight",children:(0,r.jsx)(s.span,{className:"mord mtight",children:"tick"})}),(0,r.jsx)(s.span,{className:"mbin mtight",children:"\xd7"}),(0,r.jsx)(s.span,{className:"mord text mtight",children:(0,r.jsx)(s.span,{className:"mord mtight",children:"tickStep"})})]})})]})})})})})]}),(0,r.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,r.jsx)(s.span,{className:"mbin",children:"\u2212"}),(0,r.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,r.jsx)(s.span,{className:"mord",children:"1"})]})]}),(0,r.jsxs)(s.span,{style:{top:"-2.25em"},children:[(0,r.jsx)(s.span,{className:"pstrut",style:{height:"3.008em"}}),(0,r.jsxs)(s.span,{className:"mord",children:[(0,r.jsx)(s.span,{className:"mord",children:"\u2212"}),(0,r.jsx)(s.span,{className:"mopen",children:"("}),(0,r.jsx)(s.span,{className:"mord",children:"1.0000"}),(0,r.jsxs)(s.span,{className:"mord",children:[(0,r.jsx)(s.span,{className:"mord",children:"5"}),(0,r.jsx)(s.span,{className:"msupsub",children:(0,r.jsx)(s.span,{className:"vlist-t",children:(0,r.jsx)(s.span,{className:"vlist-r",children:(0,r.jsx)(s.span,{className:"vlist",style:{height:"0.8491em"},children:(0,r.jsxs)(s.span,{style:{top:"-3.063em",marginRight:"0.05em"},children:[(0,r.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,r.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,r.jsxs)(s.span,{className:"mord mtight",children:[(0,r.jsx)(s.span,{className:"mord mtight",children:"\u2212"}),(0,r.jsx)(s.span,{className:"mord text mtight",children:(0,r.jsx)(s.span,{className:"mord mtight",children:"tick"})}),(0,r.jsx)(s.span,{className:"mbin mtight",children:"\xd7"}),(0,r.jsx)(s.span,{className:"mord text mtight",children:(0,r.jsx)(s.span,{className:"mord mtight",children:"tickStep"})})]})})]})})})})})]}),(0,r.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,r.jsx)(s.span,{className:"mbin",children:"\u2212"}),(0,r.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,r.jsx)(s.span,{className:"mord",children:"1"}),(0,r.jsx)(s.span,{className:"mclose",children:")"})]})]})]}),(0,r.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,r.jsx)(s.span,{className:"vlist-r",children:(0,r.jsx)(s.span,{className:"vlist",style:{height:"1.19em"},children:(0,r.jsx)(s.span,{})})})]})}),(0,r.jsx)(s.span,{className:"arraycolsep",style:{width:"1em"}}),(0,r.jsx)(s.span,{className:"col-align-l",children:(0,r.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,r.jsxs)(s.span,{className:"vlist-r",children:[(0,r.jsxs)(s.span,{className:"vlist",style:{height:"1.69em"},children:[(0,r.jsxs)(s.span,{style:{top:"-3.69em"},children:[(0,r.jsx)(s.span,{className:"pstrut",style:{height:"3.008em"}}),(0,r.jsxs)(s.span,{className:"mord",children:[(0,r.jsx)(s.span,{className:"mord text",children:(0,r.jsx)(s.span,{className:"mord",children:"if\xa0tick"})}),(0,r.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,r.jsx)(s.span,{className:"mrel",children:"\u2265"}),(0,r.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,r.jsx)(s.span,{className:"mord",children:"0"})]})]}),(0,r.jsxs)(s.span,{style:{top:"-2.25em"},children:[(0,r.jsx)(s.span,{className:"pstrut",style:{height:"3.008em"}}),(0,r.jsxs)(s.span,{className:"mord",children:[(0,r.jsx)(s.span,{className:"mord text",children:(0,r.jsx)(s.span,{className:"mord",children:"if\xa0tick"})}),(0,r.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,r.jsx)(s.span,{className:"mrel",children:"<"}),(0,r.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,r.jsx)(s.span,{className:"mord",children:"0"})]})]})]}),(0,r.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,r.jsx)(s.span,{className:"vlist-r",children:(0,r.jsx)(s.span,{className:"vlist",style:{height:"1.19em"},children:(0,r.jsx)(s.span,{})})})]})})]})}),(0,r.jsx)(s.span,{className:"mclose nulldelimiter"})]})]})]})]})}),"\n",(0,r.jsx)(s.p,{children:"The TickMath library provides conversion between tick indices and interest rates:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-text",children:"// Convert tick to interest rate\nint128 rate = TickMath.getRateAtTick(tick, tickStep);\n\n// Formula: rate = 1.00005^(tick * tickStep) - 1 for tick >= 0\n//          rate = -(1.00005^(-tick * tickStep) - 1) for tick < 0\n"})}),"\n",(0,r.jsx)(s.h3,{id:"examples",children:"Examples"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"// tickStep = 2\ntick = 0    -> rate = 0% (neutral)\ntick = 100  -> rate =   1.00005^200 - 1  \u2248  1.005%\ntick = -100 -> rate = -(1.00005^200 - 1) \u2248 -1.005%\n"})}),"\n",(0,r.jsx)(s.h2,{id:"matching-priority",children:"Matching Priority"}),"\n",(0,r.jsxs)(s.p,{children:["Boros order book follows the standard ",(0,r.jsx)(s.strong,{children:"rate-time priority"})," matching:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Orders offering better rates are matched first","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"For long orders: Higher rates (willing to pay more) have priority"}),"\n",(0,r.jsx)(s.li,{children:"For short orders: Lower rates (willing to receive less) have priority"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["Within the same rate level (tick), orders are matched in the order they were placed (FIFO)","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["The ",(0,r.jsx)(s.code,{children:"orderIndex"})," within each tick determines the exact queue position"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"order-id",children:"Order Id"}),"\n",(0,r.jsx)(s.p,{children:"Each order in Boros has a unique order Id, which a 64-bit packed value containing order metadata:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-text",children:"OrderId structure (64 bits):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Init(1) \u2502 Side(1)  \u2502 Tick(16)    \u2502 Index(40)    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nBit 63: Initialization marker (always 1 for valid orders)\nBit 56: Side (0 = LONG, 1 = SHORT)\nBits 40-55: Encoded tick index\nBits 0-39: Order index within tick\n"})}),"\n",(0,r.jsxs)(s.p,{children:["This encoding has a nice ordering property: orders with ",(0,r.jsx)(s.strong,{children:"lower OrderId values"})," have ",(0,r.jsx)(s.strong,{children:"higher priority"})," in the order book."]}),"\n",(0,r.jsx)(s.h3,{id:"parsing-orderid",children:"Parsing OrderId"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-text",children:"// Parsing an OrderId\n(Side side, int16 tickIndex, uint40 orderIndex) = OrderIdLib.unpack(orderId);\n\n// Quick access methods\nSide side = orderId.side();\nint16 tick = orderId.tickIndex();\nuint40 index = orderId.orderIndex();\n"})}),"\n",(0,r.jsx)(s.h2,{id:"placing-orders",children:"Placing orders"}),"\n",(0,r.jsx)(s.h3,{id:"time-in-force",children:"Time In Force"}),"\n",(0,r.jsx)(s.p,{children:"Time In Force (TIF) parameters control how orders behave during matching and placement. Boros supports five TIF types to accommodate different trading strategies:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-text",children:"enum TimeInForce {\n    GTC,       // Good Till Cancel - Standard limit order, remains on book until filled/cancelled\n    IOC,       // Immediate or Cancel - Executes against available liquidity, cancels unfilled portion\n    FOK,       // Fill or Kill - Must fill entire size or transaction reverts\n    ALO,       // Add Liquidity Only - Post-only order, transaction reverts if would match\n    SOFT_ALO   // Soft ALO - If order would match, it gets skipped (not placed on orderbook) and transaction doesn't revert\n}\n"})}),"\n",(0,r.jsx)(s.h3,{id:"self-trade-prevention",children:"Self-trade Prevention"}),"\n",(0,r.jsx)(s.p,{children:"Boros prevents self-trading by checking if an incoming order would match against the same account's existing orders. If self-matching is detected, the transaction will revert to protect traders from unintentionally trading with themselves."}),"\n",(0,r.jsx)(s.h3,{id:"restrictions",children:"Restrictions"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Order Size"}),":"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"No minimum order size requirement"}),"\n",(0,r.jsx)(s.li,{children:"No lot size restrictions - any decimal amount supported"}),"\n",(0,r.jsx)(s.li,{children:"Orders must have non-zero size"}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Order Limits"}),":"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Maximum ",(0,r.jsx)(s.strong,{children:"100 open orders"})," per account across all sides"]}),"\n",(0,r.jsx)(s.li,{children:"Exceeding this limit will cause the transaction to revert"}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Rate Bounds"}),":"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Orders with rates significantly deviating from the mark rate will be rejected:","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Buy/Long orders"}),": Rejected if rate is too far above the mark rate"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Sell/Short orders"}),": Rejected if rate is too far below the mark rate"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.li,{children:"The acceptable deviation threshold is market-specific and configured to prevent market manipulation"}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Bad Debt Prevention"}),":"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"The system continuously monitors all open orders against account health"}),"\n",(0,r.jsx)(s.li,{children:"Orders that could potentially put makers into bad debt if filled are force-cancelled"}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"twap-oracle",children:"TWAP Oracle"}),"\n",(0,r.jsxs)(s.p,{children:["Boros maintains a Time-Weighted Average Price (TWAP) oracle to calculate the ",(0,r.jsx)(s.strong,{children:"mark rate"})," - the reference rate used for margining and liquidations. Each time an order is matched against the order book. The rate of the last matched tick is incorporated into the TWAP calculation based on time elapsed."]}),"\n",(0,r.jsx)(s.p,{children:"The oracle uses a fixed-window observation approach:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"markRate = (lastTradedRate \xd7 timeElapsed + prevOracleRate \xd7 (window - timeElapsed)) / window\n"})})]})}function m(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>a,x:()=>l});var i=n(6540);const r={},t=i.createContext(r);function a(e){const s=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(t.Provider,{value:s},e.children)}}}]);